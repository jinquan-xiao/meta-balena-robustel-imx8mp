From f2a75eadf42b7542d82a7d921f65762140fa0f28 Mon Sep 17 00:00:00 2001
From: machangbao <machangbao@rt.com>
Date: Sun, 3 Nov 2024 11:49:51 +0800
Subject: [PATCH] adapts to robustel eg5120 hardware and adds support for
 balenaos boot

---
 arch/arm/dts/imx8mp-evk.dts                |  130 +-
 board/freescale/imx8mp_evk/imx8mp_evk.c    |   53 +-
 board/freescale/imx8mp_evk/lpddr4_timing.c |  101 +-
 common/usb.c                               |    2 +
 configs/imx8mp_eg5120_defconfig            | 1647 ++++++++++++++++++++
 drivers/net/dwc_eth_qos.c                  |   19 +
 drivers/net/fec_mxc.c                      |    3 +-
 drivers/net/phy/micrel_ksz90x1.c           |   97 ++
 drivers/usb/host/xhci-imx8m.c              |   12 +
 include/configs/imx8mp_evk.h               |  225 +--
 scripts/check-config.sh                    |   22 +-
 11 files changed, 2096 insertions(+), 215 deletions(-)
 mode change 100644 => 100755 board/freescale/imx8mp_evk/imx8mp_evk.c
 create mode 100644 configs/imx8mp_eg5120_defconfig
 mode change 100644 => 100755 include/configs/imx8mp_evk.h

diff --git a/arch/arm/dts/imx8mp-evk.dts b/arch/arm/dts/imx8mp-evk.dts
index 05bee3ad..cf03f418 100644
--- a/arch/arm/dts/imx8mp-evk.dts
+++ b/arch/arm/dts/imx8mp-evk.dts
@@ -19,8 +19,7 @@
 
 	memory@40000000 {
 		device_type = "memory";
-		reg = <0x0 0x40000000 0 0xc0000000>,
-		      <0x1 0x00000000 0 0xc0000000>;
+		reg = <0x0 0x40000000 0 0x80000000>;
 	};
 
 	leds {
@@ -29,22 +28,22 @@
 		pinctrl-0 = <&pinctrl_gpio_led>;
 
 		status {
-			label = "status";
-			gpios = <&gpio3 16 GPIO_ACTIVE_HIGH>;
-			default-state = "on"; /* LED GREEN */
+			label = "run";
+			gpios = <&gpio4 25 GPIO_ACTIVE_HIGH>;
 		};
 	};
 
-	reg_usb1_host_vbus: regulator-usb1-vbus {
+	reg_usb_otg1_vbus: regulator@3 {
 		compatible = "regulator-fixed";
-		regulator-name = "usb1_host_vbus";
+		regulator-name = "usb_otg1_vbus";
 		pinctrl-names = "default";
-		pinctrl-0 = <&pinctrl_usb1_vbus>;
+		pinctrl-0 = <&pinctrl_otg1_vbus>;
 		regulator-min-microvolt = <5000000>;
 		regulator-max-microvolt = <5000000>;
-		gpio = <&gpio1 14 GPIO_ACTIVE_HIGH>;
+		gpio = <&gpio1 12 GPIO_ACTIVE_HIGH>;
+		startup-delay-us = <10000>;
+		off-on-delay-us  = <10000>;
 		enable-active-high;
-		regulator-always-on;
 	};
 
 	reg_usdhc2_vmmc: regulator-usdhc2 {
@@ -58,11 +57,12 @@
 		enable-active-high;
 		startup-delay-us = <100>;
 		off-on-delay-us = <12000>;
+		status = "disabled";
 	};
 	
 	dsi_host: dsi-host {
 		compatible = "samsung,sec-mipi-dsi";
-		status = "okay";
+		status = "disabled";
 	};
 
 	rm67191_panel {
@@ -77,7 +77,7 @@
 					 */
 		panel-width-mm = <68>;
 		panel-height-mm = <121>;
-		status = "okay";
+		status = "disabled";
 
 		port {
 			rm67191_from_dsim: endpoint {
@@ -92,16 +92,23 @@
 	pinctrl-0 = <&pinctrl_eqos>;
 	phy-mode = "rgmii-id";
 	phy-handle = <&ethphy0>;
+	phy-reset-gpios = <&gpio3 14 GPIO_ACTIVE_LOW>;
+	phy-reset-duration = <100>;
 	status = "okay";
 
 	mdio {
 		compatible = "snps,dwmac-mdio";
+		pinctrl-0 = <&pinctrl_mdio>;
 		#address-cells = <1>;
 		#size-cells = <0>;
 
-		ethphy0: ethernet-phy@1 {
+
+		ethphy0: ethernet-phy@3 {
 			compatible = "ethernet-phy-ieee802.3-c22";
-			reg = <1>;
+			reg = <0x3>;
+			rxc-dll-2ns = <1>;
+			txc-dll-2ns = <1>;
+			eee-broken-100tx;
 			eee-broken-1000t;
 		};
 	};
@@ -112,17 +119,18 @@
 	pinctrl-0 = <&pinctrl_fec>;
 	phy-mode = "rgmii-id";
 	phy-handle = <&ethphy1>;
-	fsl,magic-packet;
+	phy-reset-gpios = <&gpio3 1 GPIO_ACTIVE_LOW>;
+	phy-reset-duration = <100>;
 	status = "okay";
 
 	mdio {
 		#address-cells = <1>;
 		#size-cells = <0>;
 
-		ethphy1: ethernet-phy@1 {
+		ethphy1: ethernet-phy@7 {
 			compatible = "ethernet-phy-ieee802.3-c22";
-			reg = <1>;
-			eee-broken-1000t;
+			reg = <0x7>;
+			micrel,led-mode = <1>;
 		};
 	};
 };
@@ -130,7 +138,7 @@
 &flexspi {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_flexspi0>;
-	status = "okay";
+	status = "disabled";
 
 	flash0: mt25qu256aba@0 {
 		reg = <0>;
@@ -274,7 +282,7 @@
 		reg = <0x3d>;
 		adi,addr-cec = <0x3c>;
 		adi,dsi-lanes = <4>;
-		status = "okay";
+		status = "disabled";
 
 		port {
 			adv7535_from_dsim: endpoint {
@@ -291,7 +299,7 @@
 	pinctrl-1 = <&pinctrl_i2c3_gpio>;
 	scl-gpios = <&gpio5 18 GPIO_ACTIVE_HIGH>;
 	sda-gpios = <&gpio5 19 GPIO_ACTIVE_HIGH>;
-	status = "okay";
+	status = "disabled";
 
 	pca6416: gpio@20 {
 		compatible = "ti,tca6416";
@@ -302,11 +310,11 @@
 };
 
 &lcdif1 {
-	status = "okay";
+	status = "disabled";
 };
 
 &mipi_dsi {
-	status = "okay";
+	status = "diasbled";
 
 	port@1 {
 		dsim_to_adv7535: endpoint {
@@ -322,7 +330,7 @@
 };
 
 &snvs_pwrkey {
-	status = "okay";
+	status = "disabled";
 };
 
 &uart2 {
@@ -342,6 +350,7 @@
 	srp-disable;
 	adp-disable;
 	usb-role-switch;
+	vbus-supply = <&reg_usb_otg1_vbus>;
 	status = "okay";
 };
 
@@ -354,6 +363,16 @@
 	status = "okay";
 };
 
+&usdhc1 {
+        pinctrl-names = "default", "state_100mhz", "state_200mhz";
+        pinctrl-0 = <&pinctrl_usdhc1>, <&pinctrl_usdhc1_gpio>;
+        pinctrl-1 = <&pinctrl_usdhc1_100mhz>, <&pinctrl_usdhc1_gpio>;
+        pinctrl-2 = <&pinctrl_usdhc1_200mhz>, <&pinctrl_usdhc1_gpio>;
+        bus-width = <4>;
+        cd-gpios = <&gpio2 6 GPIO_ACTIVE_LOW>;
+        status = "okay";
+};
+
 &usdhc2 {
 	pinctrl-names = "default", "state_100mhz", "state_200mhz";
 	pinctrl-0 = <&pinctrl_usdhc2>, <&pinctrl_usdhc2_gpio>;
@@ -362,7 +381,7 @@
 	cd-gpios = <&gpio2 12 GPIO_ACTIVE_LOW>;
 	vmmc-supply = <&reg_usdhc2_vmmc>;
 	bus-width = <4>;
-	status = "okay";
+	status = "disabled";
 };
 
 &usdhc3 {
@@ -401,7 +420,12 @@
 			MX8MP_IOMUXC_ENET_TD3__ENET_QOS_RGMII_TD3		0x1f
 			MX8MP_IOMUXC_ENET_TX_CTL__ENET_QOS_RGMII_TX_CTL	0x1f
 			MX8MP_IOMUXC_ENET_TXC__CCM_ENET_QOS_CLOCK_GENERATE_TX_CLK	0x1f
-			MX8MP_IOMUXC_SAI2_RXC__GPIO4_IO22		0x19
+		>;
+	};
+
+	pinctrl_mdio: mdiogrp {
+		fsl,pins = <
+			MX8MP_IOMUXC_NAND_DQS__GPIO3_IO14		0x19
 		>;
 	};
 
@@ -421,7 +445,9 @@
 			MX8MP_IOMUXC_SAI1_TXD3__ENET1_RGMII_TD3		0x1f
 			MX8MP_IOMUXC_SAI1_TXD4__ENET1_RGMII_TX_CTL	0x1f
 			MX8MP_IOMUXC_SAI1_TXD5__ENET1_RGMII_TXC		0x1f
-			MX8MP_IOMUXC_SAI1_RXD0__GPIO4_IO02		0x19
+			MX8MP_IOMUXC_NAND_CE0_B__GPIO3_IO01		0x19
+			//MX8MP_IOMUXC_SAI2_TXC__GPIO4_IO25 0x19
+			MX8MP_IOMUXC_NAND_DATA03__GPIO3_IO09 0x19
 		>;
 	};
 
@@ -432,13 +458,15 @@
 			MX8MP_IOMUXC_NAND_DATA00__FLEXSPI_A_DATA00	0x82
 			MX8MP_IOMUXC_NAND_DATA01__FLEXSPI_A_DATA01	0x82
 			MX8MP_IOMUXC_NAND_DATA02__FLEXSPI_A_DATA02	0x82
-			MX8MP_IOMUXC_NAND_DATA03__FLEXSPI_A_DATA03	0x82
+			//MX8MP_IOMUXC_NAND_DATA03__FLEXSPI_A_DATA03	0x82
 		>;
 	};
 
 	pinctrl_gpio_led: gpioledgrp {
 		fsl,pins = <
-			MX8MP_IOMUXC_NAND_READY_B__GPIO3_IO16	0x19
+			//MX8MP_IOMUXC_NAND_READY_B__GPIO3_IO16	0x19
+			MX8MP_IOMUXC_SAI2_TXC__GPIO4_IO25 0x19
+			//MX8MP_IOMUXC_NAND_DATA03__GPIO3_IO09 0x19
 		>;
 	};
 
@@ -521,12 +549,52 @@
 		>;
 	};
 
-	pinctrl_usb1_vbus: usb1grp {
+	pinctrl_otg1_vbus: usb1grp {
 		fsl,pins = <
-			MX8MP_IOMUXC_GPIO1_IO14__GPIO1_IO14	0x19
+			MX8MP_IOMUXC_GPIO1_IO12__GPIO1_IO12	0x19
 		>;
 	};
 
+        pinctrl_usdhc1_gpio: usdhc1grp-gpio {
+                fsl,pins = <
+                        MX8MP_IOMUXC_SD1_DATA4__GPIO2_IO06      0x41 /* TF Card Detect */
+                        MX8MP_IOMUXC_SD1_DATA5__GPIO2_IO07      0x41 /* TF PWR_EN */
+                >;
+        };
+
+        pinctrl_usdhc1: usdhc1grp {
+                fsl,pins = <
+                        MX8MP_IOMUXC_SD1_CLK__USDHC1_CLK        0x190
+                        MX8MP_IOMUXC_SD1_CMD__USDHC1_CMD        0x1d0
+                        MX8MP_IOMUXC_SD1_DATA0__USDHC1_DATA0    0x1d0
+                        MX8MP_IOMUXC_SD1_DATA1__USDHC1_DATA1    0x1d0
+                        MX8MP_IOMUXC_SD1_DATA2__USDHC1_DATA2    0x1d0
+                        MX8MP_IOMUXC_SD1_DATA3__USDHC1_DATA3    0x1d0
+                >;
+        };
+
+        pinctrl_usdhc1_100mhz: usdhc1grp-100mhz {
+                fsl,pins = <
+                        MX8MP_IOMUXC_SD1_CLK__USDHC1_CLK        0x194
+                        MX8MP_IOMUXC_SD1_CMD__USDHC1_CMD        0x1d4
+                        MX8MP_IOMUXC_SD1_DATA0__USDHC1_DATA0    0x1d4
+                        MX8MP_IOMUXC_SD1_DATA1__USDHC1_DATA1    0x1d4
+                        MX8MP_IOMUXC_SD1_DATA2__USDHC1_DATA2    0x1d4
+                        MX8MP_IOMUXC_SD1_DATA3__USDHC1_DATA3    0x1d4
+                >;
+        };
+
+        pinctrl_usdhc1_200mhz: usdhc1grp-200mhz {
+                fsl,pins = <
+                        MX8MP_IOMUXC_SD1_CLK__USDHC1_CLK        0x196
+                        MX8MP_IOMUXC_SD1_CMD__USDHC1_CMD        0x1d6
+                        MX8MP_IOMUXC_SD1_DATA0__USDHC1_DATA0    0x1d6
+                        MX8MP_IOMUXC_SD1_DATA1__USDHC1_DATA1    0x1d6
+                        MX8MP_IOMUXC_SD1_DATA2__USDHC1_DATA2    0x1d6
+                        MX8MP_IOMUXC_SD1_DATA3__USDHC1_DATA3    0x1d6
+                >;
+        };
+
 	pinctrl_usdhc2: usdhc2grp {
 		fsl,pins = <
 			MX8MP_IOMUXC_SD2_CLK__USDHC2_CLK	0x190
diff --git a/board/freescale/imx8mp_evk/imx8mp_evk.c b/board/freescale/imx8mp_evk/imx8mp_evk.c
old mode 100644
new mode 100755
index ff46a2b2..554ef031
--- a/board/freescale/imx8mp_evk/imx8mp_evk.c
+++ b/board/freescale/imx8mp_evk/imx8mp_evk.c
@@ -22,6 +22,7 @@
 #include <usb.h>
 #include <dwc3-uboot.h>
 #include <mmc.h>
+#include <generated/version_autogenerated.h>
 
 DECLARE_GLOBAL_DATA_PTR;
 
@@ -60,6 +61,52 @@ int board_early_init_f(void)
 	return 0;
 }
 
+#define GPIO_LED_RUN         IMX_GPIO_NR(4, 25)
+#define GPIO_LED_USR2         IMX_GPIO_NR(4, 21)
+#define GPIO_LED_USR1_GRN     IMX_GPIO_NR(4, 22)
+#define GPIO_LED_USR1_RED     IMX_GPIO_NR(4, 26)
+#define GPIO_LED_RSSI_GRN     IMX_GPIO_NR(4, 27)
+#define GPIO_LED_RSSI_RED     IMX_GPIO_NR(4, 24)
+#define GPIO_TFCARD_PWRON     IMX_GPIO_NR(2, 7)
+static void eg5120_gpio_init(void)
+{
+	gpio_request(GPIO_LED_RUN, "run_led");
+	gpio_request(GPIO_LED_USR2, "usr2_led");
+	gpio_request(GPIO_LED_USR1_GRN, "g_usr1_led");
+	gpio_request(GPIO_LED_USR1_RED, "r_usr1_led");
+	gpio_request(GPIO_LED_RSSI_GRN, "g_rssi_led");
+	gpio_request(GPIO_LED_RSSI_RED, "r_rssi_led");
+
+	/* Turn all LEDs on 1s to indicate that u-boot is booting */
+        gpio_direction_output(GPIO_LED_RUN, 1);
+        gpio_direction_output(GPIO_LED_USR2, 1);
+        gpio_direction_output(GPIO_LED_RSSI_GRN, 1);
+        gpio_direction_output(GPIO_LED_RSSI_RED, 1);
+        gpio_direction_output(GPIO_LED_USR1_GRN, 1);
+        gpio_direction_output(GPIO_LED_USR1_RED, 1);
+        mdelay(1000);
+        gpio_direction_output(GPIO_LED_RUN, 0);
+        gpio_direction_output(GPIO_LED_USR2, 0);
+        gpio_direction_output(GPIO_LED_RSSI_GRN, 0);
+        gpio_direction_output(GPIO_LED_RSSI_RED, 0);
+        gpio_direction_output(GPIO_LED_USR1_GRN, 0);
+        gpio_direction_output(GPIO_LED_USR1_RED, 0);
+        mdelay(500);
+
+	/* Turn RUN LED on only */
+	gpio_direction_output(GPIO_LED_RUN, 1);
+
+	gpio_free(GPIO_LED_RUN);
+	gpio_free(GPIO_LED_USR2);
+	gpio_free(GPIO_LED_USR1_GRN);
+	gpio_free(GPIO_LED_USR1_RED);
+	gpio_free(GPIO_LED_RSSI_GRN);
+	gpio_free(GPIO_LED_RSSI_RED);
+
+	gpio_request(GPIO_TFCARD_PWRON, "tfcard_pwr");
+	gpio_direction_output(GPIO_TFCARD_PWRON, 1);
+}
+
 #ifdef CONFIG_OF_BOARD_SETUP
 int ft_board_setup(void *blob, bd_t *bd)
 {
@@ -106,7 +153,7 @@ int ft_board_setup(void *blob, bd_t *bd)
 #endif
 
 #ifdef CONFIG_FEC_MXC
-#define FEC_RST_PAD IMX_GPIO_NR(4, 2)
+#define FEC_RST_PAD IMX_GPIO_NR(3, 1)
 static iomux_v3_cfg_t const fec1_rst_pads[] = {
 	MX8MP_PAD_SAI1_RXD0__GPIO4_IO02 | MUX_PAD_CTRL(NO_PAD_CTRL),
 };
@@ -140,7 +187,7 @@ static int setup_fec(void)
 
 #ifdef CONFIG_DWC_ETH_QOS
 
-#define EQOS_RST_PAD IMX_GPIO_NR(4, 22)
+#define EQOS_RST_PAD IMX_GPIO_NR(3, 14)
 static iomux_v3_cfg_t const eqos_rst_pads[] = {
 	MX8MP_PAD_SAI2_RXC__GPIO4_IO22 | MUX_PAD_CTRL(NO_PAD_CTRL),
 };
@@ -484,6 +531,8 @@ int board_typec_get_mode(int index)
 
 int board_init(void)
 {
+	eg5120_gpio_init();
+
 #ifdef CONFIG_USB_TCPC
 	setup_typec();
 #endif
diff --git a/board/freescale/imx8mp_evk/lpddr4_timing.c b/board/freescale/imx8mp_evk/lpddr4_timing.c
index a5325956..388b3881 100644
--- a/board/freescale/imx8mp_evk/lpddr4_timing.c
+++ b/board/freescale/imx8mp_evk/lpddr4_timing.c
@@ -1,6 +1,14 @@
-// SPDX-License-Identifier: GPL-2.0+
 /*
  * Copyright 2019 NXP
+ *
+ * SPDX-License-Identifier:	GPL-2.0+
+ *
+ * Generated code from MX8M_DDR_tool
+ *
+ * Align with uboot version:
+ * imx_v2019.04_5.4.x and above version
+ * For imx_v2018.03_4.14.78_1.0.0_ga ~ imx_v2018.04_4.19.35_1.1.0_ga:
+ * please replace #include <asm/arch/ddr.h> with #include <asm/arch/imx8m_ddr.h>
  */
 
 #include <linux/kernel.h>
@@ -10,15 +18,11 @@ struct dram_cfg_param ddr_ddrc_cfg[] = {
 	/** Initialize DDRC registers **/
 	{ 0x3d400304, 0x1 },
 	{ 0x3d400030, 0x1 },
-	{ 0x3d400000, 0xa3080020 },
+	{ 0x3d400000, 0xa1080020 },
 	{ 0x3d400020, 0x1323 },
 	{ 0x3d400024, 0x1e84800 },
-	{ 0x3d400064, 0x7a017c },
-#ifdef CONFIG_IMX8M_DRAM_INLINE_ECC
-	{ 0x3d400070, 0x1027f54 },
-#else
-	{ 0x3d400070, 0x1027f10 },
-#endif
+	{ 0x3d400064, 0x7a0118 },
+	{ 0x3d400070, 0x61027f10 },
 	{ 0x3d400074, 0x7b0 },
 	{ 0x3d4000d0, 0xc00307a3 },
 	{ 0x3d4000d4, 0xc50000 },
@@ -27,7 +31,7 @@ struct dram_cfg_param ddr_ddrc_cfg[] = {
 	{ 0x3d4000e8, 0x660048 },
 	{ 0x3d4000ec, 0x160048 },
 	{ 0x3d400100, 0x2028222a },
-	{ 0x3d400104, 0x807bf },
+	{ 0x3d400104, 0x8083f },
 	{ 0x3d40010c, 0xe0e000 },
 	{ 0x3d400110, 0x12040a12 },
 	{ 0x3d400114, 0x2050f0f },
@@ -35,7 +39,7 @@ struct dram_cfg_param ddr_ddrc_cfg[] = {
 	{ 0x3d40011c, 0x501 },
 	{ 0x3d400130, 0x20800 },
 	{ 0x3d400134, 0xe100002 },
-	{ 0x3d400138, 0x184 },
+	{ 0x3d400138, 0x120 },
 	{ 0x3d400144, 0xc80064 },
 	{ 0x3d400180, 0x3e8001e },
 	{ 0x3d400184, 0x3207a12 },
@@ -51,22 +55,13 @@ struct dram_cfg_param ddr_ddrc_cfg[] = {
 	{ 0x3d4001c4, 0x1 },
 	{ 0x3d4000f4, 0xc99 },
 	{ 0x3d400108, 0x9121c1c },
-#ifdef CONFIG_IMX8M_DRAM_INLINE_ECC
-	{ 0x3d400200, 0x13 },
-	{ 0x3d40020c, 0x13131300 },
-	{ 0x3d400210, 0x1f1f },
-	{ 0x3d400204, 0x50505 },
-	{ 0x3d400214, 0x4040404 },
-	{ 0x3d400218, 0x68040404 },
-#else
-	{ 0x3d400200, 0x16 },
+	{ 0x3d400200, 0x1f },
 	{ 0x3d40020c, 0x0 },
 	{ 0x3d400210, 0x1f1f },
 	{ 0x3d400204, 0x80808 },
 	{ 0x3d400214, 0x7070707 },
-	{ 0x3d400218, 0x68070707 },
-#endif
-	{ 0x3d40021c, 0xf08 },
+	{ 0x3d400218, 0x7070707 },
+	{ 0x3d40021c, 0xf0f },
 	{ 0x3d400250, 0x1705 },
 	{ 0x3d400254, 0x2c },
 	{ 0x3d40025c, 0x4000030 },
@@ -82,7 +77,7 @@ struct dram_cfg_param ddr_ddrc_cfg[] = {
 	{ 0x3d402020, 0x1021 },
 	{ 0x3d402024, 0x30d400 },
 	{ 0x3d402050, 0x20d000 },
-	{ 0x3d402064, 0xc0026 },
+	{ 0x3d402064, 0xc001c },
 	{ 0x3d4020dc, 0x840000 },
 	{ 0x3d4020e0, 0x330000 },
 	{ 0x3d4020e8, 0x660048 },
@@ -97,7 +92,7 @@ struct dram_cfg_param ddr_ddrc_cfg[] = {
 	{ 0x3d40211c, 0x301 },
 	{ 0x3d402130, 0x20300 },
 	{ 0x3d402134, 0xa100002 },
-	{ 0x3d402138, 0x27 },
+	{ 0x3d402138, 0x1d },
 	{ 0x3d402144, 0x14000a },
 	{ 0x3d402180, 0x640004 },
 	{ 0x3d402190, 0x3818200 },
@@ -107,7 +102,7 @@ struct dram_cfg_param ddr_ddrc_cfg[] = {
 	{ 0x3d403020, 0x1021 },
 	{ 0x3d403024, 0xc3500 },
 	{ 0x3d403050, 0x20d000 },
-	{ 0x3d403064, 0x3000a },
+	{ 0x3d403064, 0x30007 },
 	{ 0x3d4030dc, 0x840000 },
 	{ 0x3d4030e0, 0x330000 },
 	{ 0x3d4030e8, 0x660048 },
@@ -122,7 +117,7 @@ struct dram_cfg_param ddr_ddrc_cfg[] = {
 	{ 0x3d40311c, 0x301 },
 	{ 0x3d403130, 0x20300 },
 	{ 0x3d403134, 0xa100002 },
-	{ 0x3d403138, 0xa },
+	{ 0x3d403138, 0x8 },
 	{ 0x3d403144, 0x50003 },
 	{ 0x3d403180, 0x190004 },
 	{ 0x3d403190, 0x3818200 },
@@ -1063,7 +1058,6 @@ struct dram_cfg_param ddr_ddrphy_trained_csr[] = {
 	{ 0x13730, 0x0 },
 	{ 0x13830, 0x0 },
 };
-
 /* P0 message block paremeter for training firmware */
 struct dram_cfg_param ddr_fsp0_cfg[] = {
 	{ 0xd0000, 0x0 },
@@ -1075,7 +1069,7 @@ struct dram_cfg_param ddr_fsp0_cfg[] = {
 	{ 0x54009, 0xc8 },
 	{ 0x5400b, 0x2 },
 	{ 0x5400f, 0x100 },
-	{ 0x54012, 0x310 },
+	{ 0x54012, 0x110 },
 	{ 0x54019, 0x3ff4 },
 	{ 0x5401a, 0x33 },
 	{ 0x5401b, 0x4866 },
@@ -1087,7 +1081,7 @@ struct dram_cfg_param ddr_fsp0_cfg[] = {
 	{ 0x54022, 0x4800 },
 	{ 0x54024, 0x16 },
 	{ 0x5402b, 0x1000 },
-	{ 0x5402c, 0x3 },
+	{ 0x5402c, 0x1 },
 	{ 0x54032, 0xf400 },
 	{ 0x54033, 0x333f },
 	{ 0x54034, 0x6600 },
@@ -1103,6 +1097,7 @@ struct dram_cfg_param ddr_fsp0_cfg[] = {
 	{ 0xd0000, 0x1 },
 };
 
+
 /* P1 message block paremeter for training firmware */
 struct dram_cfg_param ddr_fsp1_cfg[] = {
 	{ 0xd0000, 0x0 },
@@ -1115,7 +1110,7 @@ struct dram_cfg_param ddr_fsp1_cfg[] = {
 	{ 0x54009, 0xc8 },
 	{ 0x5400b, 0x2 },
 	{ 0x5400f, 0x100 },
-	{ 0x54012, 0x310 },
+	{ 0x54012, 0x110 },
 	{ 0x54019, 0x84 },
 	{ 0x5401a, 0x33 },
 	{ 0x5401b, 0x4866 },
@@ -1127,7 +1122,7 @@ struct dram_cfg_param ddr_fsp1_cfg[] = {
 	{ 0x54022, 0x4800 },
 	{ 0x54024, 0x16 },
 	{ 0x5402b, 0x1000 },
-	{ 0x5402c, 0x3 },
+	{ 0x5402c, 0x1 },
 	{ 0x54032, 0x8400 },
 	{ 0x54033, 0x3300 },
 	{ 0x54034, 0x6600 },
@@ -1143,6 +1138,7 @@ struct dram_cfg_param ddr_fsp1_cfg[] = {
 	{ 0xd0000, 0x1 },
 };
 
+
 /* P2 message block paremeter for training firmware */
 struct dram_cfg_param ddr_fsp2_cfg[] = {
 	{ 0xd0000, 0x0 },
@@ -1155,7 +1151,7 @@ struct dram_cfg_param ddr_fsp2_cfg[] = {
 	{ 0x54009, 0xc8 },
 	{ 0x5400b, 0x2 },
 	{ 0x5400f, 0x100 },
-	{ 0x54012, 0x310 },
+	{ 0x54012, 0x110 },
 	{ 0x54019, 0x84 },
 	{ 0x5401a, 0x33 },
 	{ 0x5401b, 0x4866 },
@@ -1167,7 +1163,7 @@ struct dram_cfg_param ddr_fsp2_cfg[] = {
 	{ 0x54022, 0x4800 },
 	{ 0x54024, 0x16 },
 	{ 0x5402b, 0x1000 },
-	{ 0x5402c, 0x3 },
+	{ 0x5402c, 0x1 },
 	{ 0x54032, 0x8400 },
 	{ 0x54033, 0x3300 },
 	{ 0x54034, 0x6600 },
@@ -1183,6 +1179,7 @@ struct dram_cfg_param ddr_fsp2_cfg[] = {
 	{ 0xd0000, 0x1 },
 };
 
+
 /* P0 2D message block paremeter for training firmware */
 struct dram_cfg_param ddr_fsp0_2d_cfg[] = {
 	{ 0xd0000, 0x0 },
@@ -1193,10 +1190,9 @@ struct dram_cfg_param ddr_fsp0_2d_cfg[] = {
 	{ 0x54008, 0x61 },
 	{ 0x54009, 0xc8 },
 	{ 0x5400b, 0x2 },
-	{ 0x5400d, 0x100 },
 	{ 0x5400f, 0x100 },
 	{ 0x54010, 0x1f7f },
-	{ 0x54012, 0x310 },
+	{ 0x54012, 0x110 },
 	{ 0x54019, 0x3ff4 },
 	{ 0x5401a, 0x33 },
 	{ 0x5401b, 0x4866 },
@@ -1208,7 +1204,7 @@ struct dram_cfg_param ddr_fsp0_2d_cfg[] = {
 	{ 0x54022, 0x4800 },
 	{ 0x54024, 0x16 },
 	{ 0x5402b, 0x1000 },
-	{ 0x5402c, 0x3 },
+	{ 0x5402c, 0x1 },
 	{ 0x54032, 0xf400 },
 	{ 0x54033, 0x333f },
 	{ 0x54034, 0x6600 },
@@ -1706,15 +1702,15 @@ struct dram_cfg_param ddr_phy_pie[] = {
 	{ 0x400d7, 0x20b },
 	{ 0x2003a, 0x2 },
 	{ 0x200be, 0x3 },
-	{ 0x2000b, 0x7d },
+	{ 0x2000b, 0x465 },
 	{ 0x2000c, 0xfa },
 	{ 0x2000d, 0x9c4 },
 	{ 0x2000e, 0x2c },
-	{ 0x12000b, 0xc },
+	{ 0x12000b, 0x70 },
 	{ 0x12000c, 0x19 },
 	{ 0x12000d, 0xfa },
 	{ 0x12000e, 0x10 },
-	{ 0x22000b, 0x3 },
+	{ 0x22000b, 0x1c },
 	{ 0x22000c, 0x6 },
 	{ 0x22000d, 0x3e },
 	{ 0x22000e, 0x10 },
@@ -1855,30 +1851,3 @@ struct dram_timing_info dram_timing = {
 	.fsp_table = { 4000, 400, 100, },
 };
 
-#ifdef CONFIG_IMX8M_DRAM_INLINE_ECC
-void board_dram_ecc_scrub(void)
-{
-	ddrc_inline_ecc_scrub(0x0,0x3ffffff);
-	ddrc_inline_ecc_scrub(0x20000000,0x23ffffff);
-	ddrc_inline_ecc_scrub(0x40000000,0x43ffffff);
-	ddrc_inline_ecc_scrub(0x4000000,0x7ffffff);
-	ddrc_inline_ecc_scrub(0x24000000,0x27ffffff);
-	ddrc_inline_ecc_scrub(0x44000000,0x47ffffff);
-	ddrc_inline_ecc_scrub(0x8000000,0xbffffff);
-	ddrc_inline_ecc_scrub(0x28000000,0x2bffffff);
-	ddrc_inline_ecc_scrub(0x48000000,0x4bffffff);
-	ddrc_inline_ecc_scrub(0xc000000,0xfffffff);
-	ddrc_inline_ecc_scrub(0x2c000000,0x2fffffff);
-	ddrc_inline_ecc_scrub(0x4c000000,0x4fffffff);
-	ddrc_inline_ecc_scrub(0x10000000,0x13ffffff);
-	ddrc_inline_ecc_scrub(0x30000000,0x33ffffff);
-	ddrc_inline_ecc_scrub(0x50000000,0x53ffffff);
-	ddrc_inline_ecc_scrub(0x14000000,0x17ffffff);
-	ddrc_inline_ecc_scrub(0x34000000,0x37ffffff);
-	ddrc_inline_ecc_scrub(0x54000000,0x57ffffff);
-	ddrc_inline_ecc_scrub(0x18000000,0x1bffffff);
-	ddrc_inline_ecc_scrub(0x38000000,0x3bffffff);
-	ddrc_inline_ecc_scrub(0x58000000,0x5bffffff);
-	ddrc_inline_ecc_scrub_end(0x0,0x5fffffff);
-}
-#endif
diff --git a/common/usb.c b/common/usb.c
index 686f09a7..a7d6b9e6 100644
--- a/common/usb.c
+++ b/common/usb.c
@@ -232,6 +232,8 @@ int usb_control_msg(struct usb_device *dev, unsigned int pipe,
 		return -EINVAL;
 	}
 
+	mdelay(10);
+
 	/* set setup command */
 	setup_packet->requesttype = requesttype;
 	setup_packet->request = request;
diff --git a/configs/imx8mp_eg5120_defconfig b/configs/imx8mp_eg5120_defconfig
new file mode 100644
index 00000000..d689a1c3
--- /dev/null
+++ b/configs/imx8mp_eg5120_defconfig
@@ -0,0 +1,1647 @@
+#
+# Automatically generated file; DO NOT EDIT.
+# U-Boot 2020.04 Configuration
+#
+CONFIG_CREATE_ARCH_SYMLINK=y
+# CONFIG_ARC is not set
+CONFIG_ARM=y
+# CONFIG_M68K is not set
+# CONFIG_MICROBLAZE is not set
+# CONFIG_MIPS is not set
+# CONFIG_NDS32 is not set
+# CONFIG_NIOS2 is not set
+# CONFIG_PPC is not set
+# CONFIG_RISCV is not set
+# CONFIG_SANDBOX is not set
+# CONFIG_SH is not set
+# CONFIG_X86 is not set
+# CONFIG_XTENSA is not set
+CONFIG_SYS_ARCH="arm"
+CONFIG_SYS_CPU="armv8"
+CONFIG_SYS_SOC="imx8m"
+CONFIG_SYS_VENDOR="freescale"
+CONFIG_SYS_BOARD="imx8mp_evk"
+CONFIG_SYS_CONFIG_NAME="imx8mp_evk"
+# CONFIG_SYS_ICACHE_OFF is not set
+CONFIG_SPL_SYS_ICACHE_OFF=y
+# CONFIG_SYS_DCACHE_OFF is not set
+CONFIG_SPL_SYS_DCACHE_OFF=y
+
+#
+# ARM architecture
+#
+CONFIG_ARM64=y
+# CONFIG_POSITION_INDEPENDENT is not set
+# CONFIG_INIT_SP_RELATIVE is not set
+# CONFIG_GIC_V3_ITS is not set
+CONFIG_STATIC_RELA=y
+CONFIG_DMA_ADDR_T_64BIT=y
+CONFIG_ARM_ASM_UNIFIED=y
+# CONFIG_SYS_ARM_CACHE_CP15 is not set
+# CONFIG_SYS_ARM_MMU is not set
+# CONFIG_SYS_ARM_MPU is not set
+CONFIG_SYS_ARM_ARCH=8
+CONFIG_SYS_CACHE_SHIFT_6=y
+CONFIG_SYS_CACHELINE_SIZE=64
+# CONFIG_ARCH_CPU_INIT is not set
+CONFIG_SYS_ARCH_TIMER=y
+CONFIG_ARM_SMCCC=y
+# CONFIG_SEMIHOSTING is not set
+# CONFIG_SYS_L2CACHE_OFF is not set
+# CONFIG_ENABLE_ARM_SOC_BOOT0_HOOK is not set
+# CONFIG_SET_STACK_SIZE is not set
+CONFIG_ARM64_SUPPORT_AARCH32=y
+# CONFIG_ARCH_AT91 is not set
+# CONFIG_TARGET_EDB93XX is not set
+# CONFIG_TARGET_ASPENITE is not set
+# CONFIG_TARGET_GPLUGD is not set
+# CONFIG_ARCH_DAVINCI is not set
+# CONFIG_KIRKWOOD is not set
+# CONFIG_ARCH_MVEBU is not set
+# CONFIG_TARGET_APF27 is not set
+# CONFIG_ORION5X is not set
+# CONFIG_TARGET_SPEAR300 is not set
+# CONFIG_TARGET_SPEAR310 is not set
+# CONFIG_TARGET_SPEAR320 is not set
+# CONFIG_TARGET_SPEAR600 is not set
+# CONFIG_TARGET_STV0991 is not set
+# CONFIG_TARGET_X600 is not set
+# CONFIG_TARGET_FLEA3 is not set
+# CONFIG_TARGET_MX35PDK is not set
+# CONFIG_ARCH_BCM283X is not set
+# CONFIG_ARCH_BCM63158 is not set
+# CONFIG_ARCH_BCM68360 is not set
+# CONFIG_ARCH_BCM6858 is not set
+# CONFIG_TARGET_VEXPRESS_CA15_TC2 is not set
+# CONFIG_ARCH_BCMSTB is not set
+# CONFIG_TARGET_VEXPRESS_CA5X2 is not set
+# CONFIG_TARGET_VEXPRESS_CA9X4 is not set
+# CONFIG_TARGET_BCM23550_W1D is not set
+# CONFIG_TARGET_BCM28155_AP is not set
+# CONFIG_TARGET_BCMCYGNUS is not set
+# CONFIG_TARGET_BCMNSP is not set
+# CONFIG_TARGET_BCMNS2 is not set
+# CONFIG_ARCH_EXYNOS is not set
+# CONFIG_ARCH_S5PC1XX is not set
+# CONFIG_ARCH_HIGHBANK is not set
+# CONFIG_ARCH_INTEGRATOR is not set
+# CONFIG_ARCH_KEYSTONE is not set
+# CONFIG_ARCH_K3 is not set
+# CONFIG_ARCH_OMAP2PLUS is not set
+# CONFIG_ARCH_MESON is not set
+# CONFIG_ARCH_MEDIATEK is not set
+# CONFIG_ARCH_LPC32XX is not set
+# CONFIG_ARCH_IMX8 is not set
+CONFIG_ARCH_IMX8M=y
+# CONFIG_ARCH_IMXRT is not set
+# CONFIG_ARCH_MX23 is not set
+# CONFIG_ARCH_MX25 is not set
+# CONFIG_ARCH_MX28 is not set
+# CONFIG_ARCH_MX31 is not set
+# CONFIG_ARCH_MX7ULP is not set
+# CONFIG_ARCH_MX7 is not set
+# CONFIG_ARCH_MX6 is not set
+CONFIG_SPL_LDSCRIPT="arch/arm/cpu/armv8/u-boot-spl.lds"
+# CONFIG_ARCH_MX5 is not set
+# CONFIG_ARCH_OWL is not set
+# CONFIG_ARCH_QEMU is not set
+# CONFIG_ARCH_RMOBILE is not set
+# CONFIG_TARGET_S32V234EVB is not set
+# CONFIG_ARCH_SNAPDRAGON is not set
+# CONFIG_ARCH_SOCFPGA is not set
+# CONFIG_ARCH_SUNXI is not set
+# CONFIG_ARCH_U8500 is not set
+# CONFIG_ARCH_VERSAL is not set
+# CONFIG_ARCH_VF610 is not set
+# CONFIG_ARCH_ZYNQ is not set
+# CONFIG_ARCH_ZYNQMP_R5 is not set
+# CONFIG_ARCH_ZYNQMP is not set
+# CONFIG_TEGRA is not set
+# CONFIG_TARGET_VEXPRESS64_AEMV8A is not set
+# CONFIG_TARGET_VEXPRESS64_BASE_FVP is not set
+# CONFIG_TARGET_VEXPRESS64_JUNO is not set
+# CONFIG_TARGET_LS2080A_EMU is not set
+# CONFIG_TARGET_LS2080A_SIMU is not set
+# CONFIG_TARGET_LS1088AQDS is not set
+# CONFIG_TARGET_LS2080AQDS is not set
+# CONFIG_TARGET_LS2080ARDB is not set
+# CONFIG_TARGET_LS2081ARDB is not set
+# CONFIG_TARGET_LX2160ARDB is not set
+# CONFIG_TARGET_LX2160AQDS is not set
+# CONFIG_TARGET_HIKEY is not set
+# CONFIG_TARGET_HIKEY960 is not set
+# CONFIG_TARGET_POPLAR is not set
+# CONFIG_TARGET_LS1012AQDS is not set
+# CONFIG_TARGET_LS1012ARDB is not set
+# CONFIG_TARGET_LS1012A2G5RDB is not set
+# CONFIG_TARGET_LS1012AFRWY is not set
+# CONFIG_TARGET_LS1012AFRDM is not set
+# CONFIG_TARGET_LS1028AQDS is not set
+# CONFIG_TARGET_LS1028ARDB is not set
+# CONFIG_TARGET_LS1088ARDB is not set
+# CONFIG_TARGET_LS1021AQDS is not set
+# CONFIG_TARGET_LS1021ATWR is not set
+# CONFIG_TARGET_LS1021ATSN is not set
+# CONFIG_TARGET_LS1021AIOT is not set
+# CONFIG_TARGET_LS1043AQDS is not set
+# CONFIG_TARGET_LS1043ARDB is not set
+# CONFIG_TARGET_LS1046AQDS is not set
+# CONFIG_TARGET_LS1046ARDB is not set
+# CONFIG_TARGET_LS1046AFRWY is not set
+# CONFIG_TARGET_COLIBRI_PXA270 is not set
+# CONFIG_ARCH_UNIPHIER is not set
+# CONFIG_STM32 is not set
+# CONFIG_ARCH_STI is not set
+# CONFIG_ARCH_STM32MP is not set
+# CONFIG_ARCH_ROCKCHIP is not set
+# CONFIG_TARGET_THUNDERX_88XX is not set
+# CONFIG_ARCH_ASPEED is not set
+# CONFIG_TARGET_DURIAN is not set
+# CONFIG_TARGET_PRESIDIO_ASIC is not set
+CONFIG_SYS_TEXT_BASE=0x40200000
+CONFIG_SPL_GPIO_SUPPORT=y
+CONFIG_SPL_LIBCOMMON_SUPPORT=y
+CONFIG_SPL_LIBGENERIC_SUPPORT=y
+CONFIG_SYS_MALLOC_F_LEN=0x2000
+CONFIG_SYS_I2C_MXC_I2C1=y
+CONFIG_SYS_I2C_MXC_I2C2=y
+CONFIG_SYS_I2C_MXC_I2C3=y
+# CONFIG_SYS_I2C_MXC_I2C4 is not set
+CONFIG_ENV_SIZE=0x10000
+CONFIG_ENV_OFFSET=0x4400
+CONFIG_DM_GPIO=y
+# CONFIG_CMD_ESBC_VALIDATE is not set
+# CONFIG_USB_TCPC is not set
+CONFIG_IMX8M=y
+CONFIG_IMX8MP=y
+# CONFIG_TARGET_IMX8MQ_EVK is not set
+# CONFIG_TARGET_IMX8MQ_DDR3L_VAL is not set
+# CONFIG_TARGET_IMX8MQ_DDR4_VAL is not set
+# CONFIG_TARGET_IMX8MM_DDR4_VAL is not set
+# CONFIG_TARGET_IMX8MM_DDR3L_VAL is not set
+# CONFIG_TARGET_IMX8MM_EVK is not set
+# CONFIG_TARGET_IMX8MM_EVK_QCA is not set
+# CONFIG_TARGET_IMX8MM_DDR4_EVK is not set
+# CONFIG_TARGET_IMX8MN_EVK is not set
+# CONFIG_TARGET_IMX8MN_DDR4_EVK is not set
+# CONFIG_TARGET_IMX8MN_DDR3_EVK is not set
+CONFIG_TARGET_IMX8MP_EVK=y
+# CONFIG_TARGET_IMX8MP_DDR4_EVK is not set
+# CONFIG_TARGET_IMX8MM_AB2 is not set
+# CONFIG_TARGET_IMX8MM_DDR4_AB2 is not set
+# CONFIG_TARGET_IMX8MN_AB2 is not set
+# CONFIG_TARGET_IMX8MN_DDR4_AB2 is not set
+# CONFIG_TARGET_VERDIN_IMX8MM is not set
+# CONFIG_SPL_MMC_SUPPORT is not set
+CONFIG_SPL_SERIAL_SUPPORT=y
+CONFIG_SPL_DRIVERS_MISC_SUPPORT=y
+CONFIG_SPL_SYS_MALLOC_F_LEN=0x2000
+CONFIG_ERR_PTR_OFFSET=0x0
+CONFIG_NR_DRAM_BANKS=3
+CONFIG_SPL_SIZE_LIMIT=0
+CONFIG_SPL=y
+CONFIG_BOOTSTAGE_STASH_ADDR=0
+CONFIG_IDENT_STRING=""
+# CONFIG_SPL_FS_FAT is not set
+# CONFIG_SPL_LIBDISK_SUPPORT is not set
+# CONFIG_SPL_SPI_SUPPORT is not set
+# CONFIG_ARMV8_SPL_EXCEPTION_VECTORS is not set
+# CONFIG_ARMV8_MULTIENTRY is not set
+# CONFIG_ARMV8_SET_SMPEN is not set
+
+#
+# ARMv8 secure monitor firmware
+#
+# CONFIG_ARMV8_SEC_FIRMWARE_SUPPORT is not set
+# CONFIG_SPL_ARMV8_SEC_FIRMWARE_SUPPORT is not set
+CONFIG_PSCI_RESET=y
+# CONFIG_ARMV8_PSCI is not set
+# CONFIG_ARMV8_EA_EL3_FIRST is not set
+CONFIG_HAS_CAAM=y
+# CONFIG_IMX_OPTEE is not set
+CONFIG_ROM_UNIFIED_SECTIONS=y
+CONFIG_FSL_CAAM_KB=y
+CONFIG_IMX_SEC_INIT=y
+# CONFIG_IMX_BOOTAUX is not set
+# CONFIG_IMX_HAB is not set
+CONFIG_CSF_SIZE=0x2000
+# CONFIG_CMD_DEKBLOB is not set
+# CONFIG_IMX_CAAM_DEK_ENCAP is not set
+# CONFIG_IMX_OPTEE_DEK_ENCAP is not set
+# CONFIG_IMX_SECO_DEK_ENCAP is not set
+# CONFIG_CMD_HDMIDETECT is not set
+# CONFIG_IMX_CAAM_MFG_PROT is not set
+# CONFIG_IMX_SECO_MFG_PROT is not set
+# CONFIG_FLASH_MCUFIRMWARE_SUPPORT is not set
+CONFIG_SPL_IMX_ROMAPI_LOADADDR=0x48000000
+CONFIG_IMX_DCD_ADDR=0x00910000
+# CONFIG_IMX_TRUSTY_OS is not set
+# CONFIG_SYS_ARM_CACHE_WRITEALLOC is not set
+
+#
+# ARM debug
+#
+CONFIG_SMBIOS_PRODUCT_NAME="imx8mp_evk"
+# CONFIG_DEBUG_UART is not set
+# CONFIG_AHCI is not set
+CONFIG_SPL_TEXT_BASE=0x920000
+
+#
+# General setup
+#
+CONFIG_LOCALVERSION=""
+CONFIG_LOCALVERSION_AUTO=y
+CONFIG_CC_OPTIMIZE_FOR_SIZE=y
+# CONFIG_XEN is not set
+CONFIG_DISTRO_DEFAULTS=y
+CONFIG_ENV_VARS_UBOOT_CONFIG=y
+# CONFIG_SYS_BOOT_GET_CMDLINE is not set
+# CONFIG_SYS_BOOT_GET_KBD is not set
+CONFIG_SYS_MALLOC_F=y
+CONFIG_EXPERT=y
+CONFIG_SYS_MALLOC_CLEAR_ON_INIT=y
+# CONFIG_TOOLS_DEBUG is not set
+CONFIG_PHYS_64BIT=y
+CONFIG_SPL_IMAGE="spl/u-boot-spl.bin"
+CONFIG_BUILD_TARGET=""
+# CONFIG_SYS_CUSTOM_LDSCRIPT is not set
+CONFIG_PLATFORM_ELFENTRY="_start"
+
+#
+# Boot images
+#
+CONFIG_ANDROID_BOOT_IMAGE=y
+CONFIG_FIT=y
+CONFIG_FIT_EXTERNAL_OFFSET=0x3000
+CONFIG_FIT_ENABLE_SHA256_SUPPORT=y
+# CONFIG_FIT_SIGNATURE is not set
+# CONFIG_FIT_CIPHER is not set
+# CONFIG_FIT_VERBOSE is not set
+# CONFIG_FIT_BEST_MATCH is not set
+CONFIG_SPL_FIT=y
+# CONFIG_SPL_FIT_PRINT is not set
+CONFIG_SPL_LOAD_FIT=y
+# CONFIG_SPL_LOAD_FIT_APPLY_OVERLAY is not set
+# CONFIG_SPL_LOAD_FIT_FULL is not set
+# CONFIG_SPL_FIT_IMAGE_POST_PROCESS is not set
+CONFIG_SPL_FIT_SOURCE=""
+CONFIG_SPL_FIT_GENERATOR="arch/arm/mach-imx/mkimage_fit_atf.sh"
+CONFIG_LEGACY_IMAGE_FORMAT=y
+CONFIG_OF_BOARD_SETUP=y
+CONFIG_OF_SYSTEM_SETUP=y
+# CONFIG_OF_STDOUT_VIA_ALIAS is not set
+CONFIG_SYS_EXTRA_OPTIONS="IMX_CONFIG=arch/arm/mach-imx/imx8m/imximage-8mp-lpddr4.cfg"
+CONFIG_HAVE_SYS_TEXT_BASE=y
+CONFIG_ARCH_FIXUP_FDT_MEMORY=y
+
+#
+# API
+#
+# CONFIG_API is not set
+
+#
+# Boot timing
+#
+# CONFIG_BOOTSTAGE is not set
+CONFIG_BOOTSTAGE_RECORD_COUNT=30
+CONFIG_SPL_BOOTSTAGE_RECORD_COUNT=5
+CONFIG_TPL_BOOTSTAGE_RECORD_COUNT=5
+CONFIG_BOOTSTAGE_STASH_SIZE=0x1000
+# CONFIG_SHOW_BOOT_PROGRESS is not set
+
+#
+# Boot media
+#
+# CONFIG_NAND_BOOT is not set
+# CONFIG_ONENAND_BOOT is not set
+# CONFIG_QSPI_BOOT is not set
+# CONFIG_SATA_BOOT is not set
+# CONFIG_SD_BOOT is not set
+# CONFIG_SPI_BOOT is not set
+CONFIG_BOOTDELAY=2
+# CONFIG_USE_BOOTARGS is not set
+# CONFIG_USE_BOOTCOMMAND is not set
+# CONFIG_USE_PREBOOT is not set
+
+#
+# Console
+#
+CONFIG_MENU=y
+# CONFIG_CONSOLE_RECORD is not set
+# CONFIG_DISABLE_CONSOLE is not set
+CONFIG_LOGLEVEL=4
+CONFIG_SPL_LOGLEVEL=4
+CONFIG_TPL_LOGLEVEL=4
+# CONFIG_SILENT_CONSOLE is not set
+# CONFIG_PRE_CONSOLE_BUFFER is not set
+CONFIG_CONSOLE_MUX=y
+CONFIG_SYS_CONSOLE_IS_IN_ENV=y
+# CONFIG_SYS_CONSOLE_OVERWRITE_ROUTINE is not set
+# CONFIG_SYS_CONSOLE_ENV_OVERWRITE is not set
+# CONFIG_SYS_CONSOLE_INFO_QUIET is not set
+CONFIG_SYS_STDIO_DEREGISTER=y
+
+#
+# Logging
+#
+# CONFIG_LOG is not set
+CONFIG_LOG_DEFAULT_LEVEL=6
+CONFIG_SUPPORT_RAW_INITRD=y
+CONFIG_DEFAULT_FDT_FILE="imx8mp-evk.dtb"
+# CONFIG_MISC_INIT_R is not set
+# CONFIG_VERSION_VARIABLE is not set
+CONFIG_BOARD_LATE_INIT=y
+CONFIG_DISPLAY_CPUINFO=y
+CONFIG_DISPLAY_BOARDINFO=y
+# CONFIG_DISPLAY_BOARDINFO_LATE is not set
+# CONFIG_BOUNCE_BUFFER is not set
+# CONFIG_BOARD_TYPES is not set
+
+#
+# Start-up hooks
+#
+# CONFIG_ARCH_EARLY_INIT_R is not set
+CONFIG_ARCH_MISC_INIT=y
+CONFIG_BOARD_EARLY_INIT_F=y
+# CONFIG_BOARD_EARLY_INIT_R is not set
+# CONFIG_LAST_STAGE_INIT is not set
+
+#
+# Security support
+#
+
+#
+# Update support
+#
+# CONFIG_UPDATE_TFTP is not set
+# CONFIG_ANDROID_AB is not set
+
+#
+# Blob list
+#
+# CONFIG_BLOBLIST is not set
+
+#
+# SPL / TPL
+#
+CONFIG_SUPPORT_SPL=y
+CONFIG_SPL_FRAMEWORK=y
+# CONFIG_SPL_FRAMEWORK_BOARD_INIT_F is not set
+CONFIG_SPL_SYS_STACK_F_CHECK_BYTE=0xaa
+# CONFIG_SPL_SYS_REPORT_STACK_F_USAGE is not set
+
+#
+# PowerPC and LayerScape SPL Boot options
+#
+CONFIG_SPL_BOARD_INIT=y
+CONFIG_SPL_BOOTROM_SUPPORT=y
+# CONFIG_SPL_RAW_IMAGE_SUPPORT is not set
+# CONFIG_SPL_LEGACY_IMAGE_SUPPORT is not set
+# CONFIG_SPL_SYS_MALLOC_SIMPLE is not set
+# CONFIG_SPL_STACK_R is not set
+CONFIG_SPL_SEPARATE_BSS=y
+CONFIG_SPL_BANNER_PRINT=y
+# CONFIG_SPL_DISPLAY_PRINT is not set
+# CONFIG_SYS_MMCSD_RAW_MODE_U_BOOT_USE_SECTOR is not set
+# CONFIG_SYS_MMCSD_RAW_MODE_U_BOOT_USE_PARTITION is not set
+# CONFIG_SUPPORT_EMMC_BOOT_OVERRIDE_PART_CONFIG is not set
+# CONFIG_SPL_CRC32_SUPPORT is not set
+# CONFIG_SPL_MD5_SUPPORT is not set
+# CONFIG_SPL_SHA1_SUPPORT is not set
+# CONFIG_SPL_SHA256_SUPPORT is not set
+CONFIG_SPL_FIT_IMAGE_TINY=y
+# CONFIG_SPL_CACHE_SUPPORT is not set
+# CONFIG_SPL_CPU_SUPPORT is not set
+CONFIG_SPL_CRYPTO_SUPPORT=y
+# CONFIG_SPL_HASH_SUPPORT is not set
+# CONFIG_SPL_DMA is not set
+# CONFIG_SPL_DM_GPIO is not set
+# CONFIG_SPL_ENV_SUPPORT is not set
+# CONFIG_SPL_FS_EXT4 is not set
+# CONFIG_SPL_FAT_WRITE is not set
+# CONFIG_SPL_FPGA_SUPPORT is not set
+CONFIG_SPL_I2C_SUPPORT=y
+# CONFIG_SPL_DM_MAILBOX is not set
+# CONFIG_SPL_MPC8XXX_INIT_DDR_SUPPORT is not set
+# CONFIG_SPL_MTD_SUPPORT is not set
+# CONFIG_SPL_MUSB_NEW_SUPPORT is not set
+# CONFIG_SPL_NAND_SUPPORT is not set
+# CONFIG_SPL_UBI is not set
+# CONFIG_SPL_NET_SUPPORT is not set
+# CONFIG_SPL_NO_CPU_SUPPORT is not set
+# CONFIG_SPL_NOR_SUPPORT is not set
+# CONFIG_SPL_XIP_SUPPORT is not set
+# CONFIG_SPL_ONENAND_SUPPORT is not set
+# CONFIG_SPL_OS_BOOT is not set
+CONFIG_SPL_PAYLOAD="u-boot.bin"
+# CONFIG_SPL_PCI is not set
+# CONFIG_SPL_PCH_SUPPORT is not set
+# CONFIG_SPL_POST_MEM_SUPPORT is not set
+# CONFIG_SPL_DM_RESET is not set
+CONFIG_SPL_POWER_SUPPORT=y
+# CONFIG_SPL_POWER_DOMAIN is not set
+# CONFIG_SPL_RAM_SUPPORT is not set
+# CONFIG_SPL_REMOTEPROC is not set
+# CONFIG_SPL_RTC_SUPPORT is not set
+# CONFIG_SPL_SATA_SUPPORT is not set
+# CONFIG_SPL_THERMAL is not set
+# CONFIG_SPL_USB_HOST_SUPPORT is not set
+# CONFIG_SPL_USB_GADGET is not set
+# CONFIG_SPL_WATCHDOG_SUPPORT is not set
+# CONFIG_SPL_YMODEM_SUPPORT is not set
+# CONFIG_SPL_ATF is not set
+# CONFIG_SPL_AM33XX_ENABLE_RTC32K_OSC is not set
+# CONFIG_SPL_OPTEE is not set
+
+#
+# Command line interface
+#
+CONFIG_CMDLINE=y
+CONFIG_HUSH_PARSER=y
+CONFIG_CMDLINE_EDITING=y
+CONFIG_AUTO_COMPLETE=y
+CONFIG_SYS_LONGHELP=y
+CONFIG_SYS_PROMPT="u-boot=> "
+CONFIG_SYS_XTRACE="y"
+
+#
+# Autoboot options
+#
+CONFIG_AUTOBOOT=y
+# CONFIG_AUTOBOOT_KEYED is not set
+# CONFIG_AUTOBOOT_USE_MENUKEY is not set
+
+#
+# Commands
+#
+
+#
+# Info commands
+#
+CONFIG_CMD_BDI=y
+# CONFIG_CMD_CONFIG is not set
+CONFIG_CMD_CONSOLE=y
+# CONFIG_CMD_CPU is not set
+# CONFIG_CMD_LICENSE is not set
+# CONFIG_CMD_PMC is not set
+
+#
+# Boot commands
+#
+CONFIG_CMD_BOOTD=y
+CONFIG_CMD_BOOTM=y
+CONFIG_BOOTM_EFI=y
+CONFIG_CMD_BOOTZ=y
+CONFIG_CMD_BOOTI=y
+CONFIG_BOOTM_LINUX=y
+# CONFIG_BOOTM_NETBSD is not set
+# CONFIG_BOOTM_OPENRTOS is not set
+# CONFIG_BOOTM_OSE is not set
+CONFIG_BOOTM_PLAN9=y
+CONFIG_BOOTM_RTEMS=y
+CONFIG_BOOTM_VXWORKS=y
+CONFIG_CMD_BOOTEFI=y
+CONFIG_CMD_BOOTEFI_HELLO_COMPILE=y
+# CONFIG_CMD_BOOTEFI_HELLO is not set
+# CONFIG_CMD_BOOTEFI_SELFTEST is not set
+# CONFIG_CMD_BOOTMENU is not set
+# CONFIG_CMD_ADTIMG is not set
+# CONFIG_CMD_ABOOTIMG is not set
+CONFIG_CMD_ELF=y
+CONFIG_CMD_FDT=y
+CONFIG_CMD_GO=y
+CONFIG_CMD_RUN=y
+CONFIG_CMD_IMI=y
+# CONFIG_CMD_IMLS is not set
+CONFIG_CMD_XIMG=y
+# CONFIG_CMD_SPL is not set
+# CONFIG_CMD_FITUPD is not set
+# CONFIG_CMD_FSL_CAAM_KB is not set
+# CONFIG_CMD_THOR_DOWNLOAD is not set
+# CONFIG_CMD_ZBOOT is not set
+
+#
+# Environment commands
+#
+# CONFIG_CMD_ASKENV is not set
+# CONFIG_CMD_EXPORTENV is not set
+# CONFIG_CMD_IMPORTENV is not set
+CONFIG_CMD_EDITENV=y
+# CONFIG_CMD_GREPENV is not set
+CONFIG_CMD_SAVEENV=y
+CONFIG_CMD_ERASEENV=y
+CONFIG_CMD_ENV_EXISTS=y
+# CONFIG_CMD_ENV_CALLBACK is not set
+# CONFIG_CMD_ENV_FLAGS is not set
+# CONFIG_CMD_NVEDIT_EFI is not set
+# CONFIG_CMD_NVEDIT_INFO is not set
+
+#
+# Memory commands
+#
+# CONFIG_CMD_BINOP is not set
+# CONFIG_CMD_CRC32 is not set
+# CONFIG_CMD_EEPROM is not set
+# CONFIG_LOOPW is not set
+# CONFIG_CMD_MD5SUM is not set
+# CONFIG_CMD_MEMINFO is not set
+CONFIG_CMD_MEMORY=y
+# CONFIG_CMD_MX_CYCLIC is not set
+CONFIG_CMD_RANDOM=y
+CONFIG_CMD_MEMTEST=y
+# CONFIG_SYS_ALT_MEMTEST is not set
+# CONFIG_CMD_SHA1SUM is not set
+# CONFIG_CMD_STRINGS is not set
+
+#
+# Compression commands
+#
+# CONFIG_CMD_LZMADEC is not set
+CONFIG_CMD_UNZIP=y
+# CONFIG_CMD_ZIP is not set
+
+#
+# Device access commands
+#
+# CONFIG_CMD_ARMFLASH is not set
+# CONFIG_CMD_ADC is not set
+# CONFIG_CMD_BCB is not set
+# CONFIG_CMD_BIND is not set
+CONFIG_CMD_CLK=y
+# CONFIG_CMD_DEMO is not set
+# CONFIG_CMD_DFU is not set
+CONFIG_CMD_DM=y
+CONFIG_CMD_FASTBOOT=y
+# CONFIG_CMD_FPGAD is not set
+CONFIG_CMD_FUSE=y
+CONFIG_CMD_GPIO=y
+CONFIG_CMD_GPT=y
+CONFIG_RANDOM_UUID=y
+CONFIG_CMD_GPT_RENAME=y
+# CONFIG_CMD_IDE is not set
+# CONFIG_CMD_IO is not set
+# CONFIG_CMD_IOTRACE is not set
+CONFIG_CMD_I2C=y
+CONFIG_CMD_LOADB=y
+CONFIG_CMD_LOADS=y
+CONFIG_CMD_MMC=y
+# CONFIG_CMD_MMC_RPMB is not set
+# CONFIG_CMD_MMC_SWRITE is not set
+# CONFIG_CMD_OSD is not set
+CONFIG_CMD_PART=y
+# CONFIG_CMD_PCI is not set
+CONFIG_CMD_PINMUX=y
+# CONFIG_CMD_POWEROFF is not set
+# CONFIG_CMD_READ is not set
+# CONFIG_CMD_SATA is not set
+# CONFIG_CMD_SAVES is not set
+# CONFIG_CMD_SCSI is not set
+# CONFIG_CMD_SDRAM is not set
+CONFIG_CMD_SF=y
+# CONFIG_CMD_SF_TEST is not set
+# CONFIG_CMD_SPI is not set
+# CONFIG_CMD_TSI148 is not set
+# CONFIG_CMD_UNIVERSE is not set
+# CONFIG_CMD_USB is not set
+# CONFIG_CMD_USB_SDP is not set
+# CONFIG_CMD_USB_MASS_STORAGE is not set
+
+#
+# Shell scripting commands
+#
+CONFIG_CMD_ECHO=y
+CONFIG_CMD_ITEST=y
+CONFIG_CMD_SOURCE=y
+CONFIG_CMD_SETEXPR=y
+
+#
+# Android support commands
+#
+CONFIG_CMD_NET=y
+CONFIG_CMD_BOOTP=y
+CONFIG_CMD_DHCP=y
+CONFIG_BOOTP_BOOTPATH=y
+CONFIG_BOOTP_DNS=y
+# CONFIG_BOOTP_DNS2 is not set
+CONFIG_BOOTP_GATEWAY=y
+CONFIG_BOOTP_HOSTNAME=y
+# CONFIG_BOOTP_PREFER_SERVERIP is not set
+CONFIG_BOOTP_SUBNETMASK=y
+# CONFIG_BOOTP_NTPSERVER is not set
+# CONFIG_CMD_PCAP is not set
+CONFIG_BOOTP_PXE=y
+CONFIG_BOOTP_PXE_CLIENTARCH=0x16
+CONFIG_BOOTP_VCI_STRING="U-Boot.armv8"
+CONFIG_CMD_TFTPBOOT=y
+# CONFIG_CMD_TFTPPUT is not set
+# CONFIG_CMD_TFTPSRV is not set
+CONFIG_NET_TFTP_VARS=y
+# CONFIG_CMD_RARP is not set
+CONFIG_CMD_NFS=y
+CONFIG_CMD_MII=y
+CONFIG_CMD_MDIO=y
+CONFIG_CMD_PING=y
+# CONFIG_CMD_CDP is not set
+# CONFIG_CMD_SNTP is not set
+# CONFIG_CMD_DNS is not set
+# CONFIG_CMD_LINK_LOCAL is not set
+# CONFIG_CMD_ETHSW is not set
+CONFIG_CMD_PXE=y
+# CONFIG_CMD_WOL is not set
+
+#
+# Misc commands
+#
+# CONFIG_CMD_BMP is not set
+# CONFIG_CMD_BSP is not set
+# CONFIG_CMD_BKOPS_ENABLE is not set
+CONFIG_CMD_BLOCK_CACHE=y
+CONFIG_CMD_CACHE=y
+# CONFIG_CMD_CONITRACE is not set
+# CONFIG_CMD_CLS is not set
+# CONFIG_CMD_EFIDEBUG is not set
+# CONFIG_CMD_EXCEPTION is not set
+CONFIG_CMD_LED=y
+# CONFIG_CMD_DATE is not set
+# CONFIG_CMD_TIME is not set
+# CONFIG_CMD_GETTIME is not set
+CONFIG_CMD_MISC=y
+# CONFIG_MP is not set
+# CONFIG_CMD_TIMER is not set
+CONFIG_CMD_SYSBOOT=y
+# CONFIG_CMD_QFW is not set
+# CONFIG_CMD_TERMINAL is not set
+# CONFIG_CMD_UUID is not set
+
+#
+# TI specific command line interface
+#
+# CONFIG_CMD_DDR3 is not set
+
+#
+# Power commands
+#
+CONFIG_CMD_REGULATOR=y
+
+#
+# Security commands
+#
+# CONFIG_CMD_AES is not set
+# CONFIG_CMD_BLOB is not set
+# CONFIG_CMD_HASH is not set
+# CONFIG_CMD_HVC is not set
+# CONFIG_CMD_SMC is not set
+
+#
+# Firmware commands
+#
+
+#
+# Filesystem commands
+#
+# CONFIG_CMD_BTRFS is not set
+CONFIG_CMD_EXT2=y
+CONFIG_CMD_EXT4=y
+CONFIG_CMD_EXT4_WRITE=y
+CONFIG_CMD_FAT=y
+CONFIG_CMD_FS_GENERIC=y
+CONFIG_CMD_FS_UUID=y
+# CONFIG_CMD_JFFS2 is not set
+CONFIG_MTDIDS_DEFAULT=""
+CONFIG_MTDPARTS_DEFAULT=""
+# CONFIG_CMD_REISER is not set
+# CONFIG_CMD_ZFS is not set
+
+#
+# Debug commands
+#
+# CONFIG_CMD_BEDBUG is not set
+# CONFIG_CMD_DIAG is not set
+# CONFIG_CMD_LOG is not set
+# CONFIG_CMD_TRACE is not set
+# CONFIG_CMD_UBI is not set
+
+#
+# Partition Types
+#
+CONFIG_PARTITIONS=y
+# CONFIG_MAC_PARTITION is not set
+# CONFIG_SPL_MAC_PARTITION is not set
+CONFIG_DOS_PARTITION=y
+CONFIG_SPL_DOS_PARTITION=y
+# CONFIG_ISO_PARTITION is not set
+# CONFIG_SPL_ISO_PARTITION is not set
+# CONFIG_AMIGA_PARTITION is not set
+# CONFIG_SPL_AMIGA_PARTITION is not set
+CONFIG_EFI_PARTITION=y
+CONFIG_EFI_PARTITION_ENTRIES_NUMBERS=128
+CONFIG_EFI_PARTITION_ENTRIES_OFF=0
+CONFIG_SPL_EFI_PARTITION=y
+CONFIG_PARTITION_UUIDS=y
+CONFIG_SPL_PARTITION_UUIDS=y
+# CONFIG_PARTITION_TYPE_GUID is not set
+CONFIG_SUPPORT_OF_CONTROL=y
+CONFIG_DTC=y
+
+#
+# Device Tree Control
+#
+CONFIG_OF_CONTROL=y
+# CONFIG_OF_BOARD_FIXUP is not set
+# CONFIG_SPL_OF_CONTROL is not set
+# CONFIG_OF_LIVE is not set
+CONFIG_OF_SEPARATE=y
+# CONFIG_OF_EMBED is not set
+# CONFIG_OF_BOARD is not set
+# CONFIG_OF_PRIOR_STAGE is not set
+CONFIG_DEFAULT_DEVICE_TREE="imx8mp-evk"
+CONFIG_OF_LIST="imx8mp-evk"
+# CONFIG_MULTI_DTB_FIT is not set
+# CONFIG_OF_DTB_PROPS_REMOVE is not set
+CONFIG_MKIMAGE_DTC_PATH="dtc"
+
+#
+# Environment
+#
+CONFIG_ENV_SUPPORT=y
+CONFIG_ENV_IS_NOWHERE=y
+# CONFIG_ENV_IS_IN_EEPROM is not set
+# CONFIG_ENV_IS_IN_FAT is not set
+# CONFIG_ENV_IS_IN_EXT4 is not set
+# CONFIG_ENV_IS_IN_FLASH is not set
+CONFIG_ENV_IS_IN_MMC=y
+# CONFIG_ENV_IS_IN_NAND is not set
+# CONFIG_ENV_IS_IN_NVRAM is not set
+# CONFIG_ENV_IS_IN_ONENAND is not set
+# CONFIG_ENV_IS_IN_REMOTE is not set
+# CONFIG_ENV_IS_IN_SATA is not set
+# CONFIG_ENV_IS_IN_SPI_FLASH is not set
+# CONFIG_SYS_REDUNDAND_ENVIRONMENT is not set
+CONFIG_SYS_RELOC_GD_ENV_ADDR=y
+# CONFIG_USE_DEFAULT_ENV_FILE is not set
+CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG=y
+CONFIG_NET=y
+CONFIG_NET_RANDOM_ETHADDR=y
+# CONFIG_NETCONSOLE is not set
+# CONFIG_IP_DEFRAG is not set
+CONFIG_TFTP_BLOCKSIZE=1468
+
+#
+# Device Drivers
+#
+
+#
+# Generic Driver Options
+#
+CONFIG_DM=y
+# CONFIG_SPL_DM is not set
+CONFIG_DM_WARN=y
+# CONFIG_DM_DEBUG is not set
+CONFIG_DM_DEVICE_REMOVE=y
+CONFIG_DM_STDIO=y
+CONFIG_DM_SEQ_ALIAS=y
+CONFIG_REGMAP=y
+CONFIG_SYSCON=y
+# CONFIG_DEVRES is not set
+CONFIG_SIMPLE_BUS=y
+CONFIG_OF_TRANSLATE=y
+# CONFIG_TRANSLATION_OFFSET is not set
+CONFIG_DM_DEV_READ_INLINE=y
+# CONFIG_ADC is not set
+# CONFIG_ADC_EXYNOS is not set
+# CONFIG_ADC_SANDBOX is not set
+# CONFIG_SARADC_MESON is not set
+# CONFIG_SARADC_ROCKCHIP is not set
+# CONFIG_SATA is not set
+# CONFIG_SCSI_AHCI is not set
+
+#
+# SATA/SCSI device support
+#
+# CONFIG_DWC_AHSATA is not set
+# CONFIG_FSL_SATA is not set
+# CONFIG_MVSATA_IDE is not set
+# CONFIG_SATA_MV is not set
+# CONFIG_SATA_SIL is not set
+# CONFIG_SATA_SIL3114 is not set
+# CONFIG_AXI is not set
+CONFIG_BLK=y
+CONFIG_HAVE_BLOCK_DEVICE=y
+CONFIG_BLOCK_CACHE=y
+# CONFIG_IDE is not set
+# CONFIG_BOOTCOUNT_LIMIT is not set
+
+#
+# Cache Controller drivers
+#
+# CONFIG_CACHE is not set
+# CONFIG_L2X0_CACHE is not set
+# CONFIG_NCORE_CACHE is not set
+
+#
+# Clock
+#
+CONFIG_CLK=y
+# CONFIG_SPL_CLK_CCF is not set
+CONFIG_CLK_CCF=y
+CONFIG_CLK_COMPOSITE_CCF=y
+# CONFIG_CLK_HSDK is not set
+# CONFIG_CLK_CDCE9XX is not set
+# CONFIG_CLK_AT91 is not set
+# CONFIG_SPL_CLK_IMX8MM is not set
+# CONFIG_CLK_IMX8MM is not set
+# CONFIG_SPL_CLK_IMX8MN is not set
+# CONFIG_CLK_IMX8MN is not set
+# CONFIG_SPL_CLK_IMX8MP is not set
+CONFIG_CLK_IMX8MP=y
+# CONFIG_CLK_SIFIVE is not set
+# CONFIG_ICS8N3QV01 is not set
+# CONFIG_CLK_MPC83XX is not set
+# CONFIG_CPU is not set
+
+#
+# Hardware crypto devices
+#
+# CONFIG_CAAM_KB_SELF_TEST is not set
+# CONFIG_FSL_CAAM is not set
+CONFIG_SYS_FSL_SEC_COMPAT_4=y
+# CONFIG_SYS_FSL_SEC_BE is not set
+CONFIG_SYS_FSL_SEC_LE=y
+
+#
+# i.MX8M DDR controllers
+#
+CONFIG_IMX8M_DRAM=y
+CONFIG_IMX8M_LPDDR4=y
+# CONFIG_IMX8M_4G_LPDDR4 is not set
+# CONFIG_IMX8M_DDR4 is not set
+# CONFIG_IMX8M_DDR3L is not set
+CONFIG_SAVED_DRAM_TIMING_BASE=0x180000
+# CONFIG_IMX8M_DRAM_INLINE_ECC is not set
+
+#
+# Demo for driver model
+#
+# CONFIG_DM_DEMO is not set
+# CONFIG_BOARD is not set
+
+#
+# DFU support
+#
+
+#
+# DMA Support
+#
+# CONFIG_DMA is not set
+# CONFIG_TI_EDMA3 is not set
+# CONFIG_APBH_DMA is not set
+
+#
+# Fastboot support
+#
+CONFIG_FASTBOOT=y
+CONFIG_USB_FUNCTION_FASTBOOT=y
+# CONFIG_UDP_FUNCTION_FASTBOOT is not set
+CONFIG_FASTBOOT_BUF_ADDR=0x42800000
+CONFIG_FASTBOOT_BUF_SIZE=0x40000000
+CONFIG_FASTBOOT_USB_DEV=0
+CONFIG_FASTBOOT_FLASH=y
+CONFIG_FASTBOOT_UUU_SUPPORT=y
+CONFIG_FSL_FASTBOOT=y
+# CONFIG_ANDROID_RECOVERY is not set
+# CONFIG_CMD_BOOTA is not set
+# CONFIG_BCB_SUPPORT is not set
+# CONFIG_FASTBOOT_LOCK is not set
+CONFIG_FIRMWARE=y
+# CONFIG_SPL_FIRMWARE is not set
+CONFIG_ARM_PSCI_FW=y
+# CONFIG_ZYNQMP_FIRMWARE is not set
+
+#
+# FPGA support
+#
+# CONFIG_FPGA_ALTERA is not set
+# CONFIG_FPGA_SOCFPGA is not set
+# CONFIG_FPGA_XILINX is not set
+
+#
+# GPIO Support
+#
+# CONFIG_GPIO_HOG is not set
+# CONFIG_ALTERA_PIO is not set
+# CONFIG_DWAPB_GPIO is not set
+# CONFIG_AT91_GPIO is not set
+# CONFIG_ATMEL_PIO4 is not set
+# CONFIG_DA8XX_GPIO is not set
+# CONFIG_INTEL_BROADWELL_GPIO is not set
+# CONFIG_INTEL_GPIO is not set
+# CONFIG_INTEL_ICH6_GPIO is not set
+# CONFIG_IMX_RGPIO2P is not set
+# CONFIG_HSDK_CREG_GPIO is not set
+# CONFIG_LPC32XX_GPIO is not set
+# CONFIG_MSM_GPIO is not set
+CONFIG_MXC_GPIO=y
+# CONFIG_MXS_GPIO is not set
+# CONFIG_CMD_PCA953X is not set
+# CONFIG_PCF8575_GPIO is not set
+# CONFIG_ROCKCHIP_GPIO is not set
+# CONFIG_XILINX_GPIO is not set
+# CONFIG_CMD_TCA642X is not set
+# CONFIG_TEGRA_GPIO is not set
+# CONFIG_TEGRA186_GPIO is not set
+# CONFIG_VYBRID_GPIO is not set
+# CONFIG_SIFIVE_GPIO is not set
+# CONFIG_DM_74X164 is not set
+CONFIG_DM_PCA953X=y
+# CONFIG_SPL_DM_PCA953X is not set
+# CONFIG_MPC8XXX_GPIO is not set
+
+#
+# Hardware Spinlock Support
+#
+# CONFIG_DM_HWSPINLOCK is not set
+
+#
+# I2C support
+#
+CONFIG_DM_I2C=y
+# CONFIG_I2C_SET_DEFAULT_BUS_NUM is not set
+# CONFIG_DM_I2C_GPIO is not set
+# CONFIG_SYS_I2C_FSL is not set
+# CONFIG_SYS_I2C_CADENCE is not set
+# CONFIG_SYS_I2C_DW is not set
+# CONFIG_SYS_I2C_INTEL is not set
+# CONFIG_SYS_I2C_IMX_LPI2C is not set
+# CONFIG_SYS_I2C_IMX_VIRT_I2C is not set
+CONFIG_SYS_I2C_MXC=y
+# CONFIG_SYS_I2C_MXC_I2C5 is not set
+# CONFIG_SYS_I2C_MXC_I2C6 is not set
+# CONFIG_SYS_I2C_MXC_I2C7 is not set
+# CONFIG_SYS_I2C_MXC_I2C8 is not set
+CONFIG_SYS_MXC_I2C1_SPEED=100000
+CONFIG_SYS_MXC_I2C1_SLAVE=0
+CONFIG_SYS_MXC_I2C2_SPEED=100000
+CONFIG_SYS_MXC_I2C2_SLAVE=0
+CONFIG_SYS_MXC_I2C3_SPEED=100000
+CONFIG_SYS_MXC_I2C3_SLAVE=0
+# CONFIG_SYS_I2C_ROCKCHIP is not set
+# CONFIG_SYS_I2C_MVTWSI is not set
+# CONFIG_SYS_I2C_XILINX_XIIC is not set
+# CONFIG_SYS_I2C_IHS is not set
+# CONFIG_I2C_MUX is not set
+CONFIG_INPUT=y
+# CONFIG_DM_KEYBOARD is not set
+# CONFIG_CROS_EC_KEYB is not set
+# CONFIG_TEGRA_KEYBOARD is not set
+# CONFIG_TWL4030_INPUT is not set
+
+#
+# LED Support
+#
+CONFIG_LED=y
+# CONFIG_LED_BLINK is not set
+CONFIG_LED_GPIO=y
+# CONFIG_LED_STATUS is not set
+
+#
+# Mailbox Controller Support
+#
+# CONFIG_DM_MAILBOX is not set
+
+#
+# Memory Controller drivers
+#
+
+#
+# Multifunction device drivers
+#
+# CONFIG_MISC is not set
+# CONFIG_CROS_EC is not set
+# CONFIG_SPL_CROS_EC is not set
+# CONFIG_DS4510 is not set
+# CONFIG_FSL_SEC_MON is not set
+CONFIG_MXC_OCOTP=y
+# CONFIG_NUVOTON_NCT6102D is not set
+# CONFIG_PWRSEQ is not set
+# CONFIG_PCA9551_LED is not set
+# CONFIG_TWL4030_LED is not set
+# CONFIG_WINBOND_W83627 is not set
+CONFIG_ZYNQ_GEM_I2C_MAC_OFFSET=0x0
+# CONFIG_FS_LOADER is not set
+
+#
+# MMC Host controller Support
+#
+CONFIG_MMC=y
+CONFIG_MMC_WRITE=y
+# CONFIG_MMC_BROKEN_CD is not set
+CONFIG_DM_MMC=y
+# CONFIG_MMC_SPI is not set
+# CONFIG_ARM_PL180_MMCI is not set
+CONFIG_MMC_QUIRKS=y
+CONFIG_MMC_HW_PARTITIONING=y
+# CONFIG_SUPPORT_EMMC_RPMB is not set
+CONFIG_SUPPORT_EMMC_BOOT=y
+CONFIG_MMC_IO_VOLTAGE=y
+# CONFIG_SPL_MMC_IO_VOLTAGE is not set
+CONFIG_MMC_UHS_SUPPORT=y
+CONFIG_MMC_HS400_ES_SUPPORT=y
+# CONFIG_SPL_MMC_HS400_ES_SUPPORT is not set
+CONFIG_MMC_HS400_SUPPORT=y
+# CONFIG_SPL_MMC_HS400_SUPPORT is not set
+CONFIG_MMC_HS200_SUPPORT=y
+# CONFIG_SPL_MMC_HS200_SUPPORT is not set
+CONFIG_MMC_VERBOSE=y
+# CONFIG_MMC_TRACE is not set
+# CONFIG_MMC_DW is not set
+# CONFIG_MMC_MXC is not set
+# CONFIG_MMC_PCI is not set
+# CONFIG_MMC_OMAP_HS is not set
+# CONFIG_MMC_SDHCI is not set
+# CONFIG_STM32_SDMMC2 is not set
+# CONFIG_FTSDC010 is not set
+# CONFIG_FSL_ESDHC is not set
+CONFIG_FSL_ESDHC_IMX=y
+# CONFIG_FSL_USDHC is not set
+
+#
+# MTD Support
+#
+# CONFIG_MTD is not set
+# CONFIG_DM_MTD is not set
+# CONFIG_MTD_NOR_FLASH is not set
+# CONFIG_FLASH_CFI_DRIVER is not set
+# CONFIG_HBMC_AM654 is not set
+# CONFIG_MTD_RAW_NAND is not set
+
+#
+# SPI Flash Support
+#
+CONFIG_DM_SPI_FLASH=y
+CONFIG_SPI_FLASH=y
+CONFIG_SF_DEFAULT_BUS=0
+CONFIG_SF_DEFAULT_CS=0
+CONFIG_SF_DEFAULT_MODE=0
+CONFIG_SF_DEFAULT_SPEED=40000000
+CONFIG_SPI_FLASH_BAR=y
+# CONFIG_SF_DUAL_FLASH is not set
+# CONFIG_SPI_FLASH_ATMEL is not set
+# CONFIG_SPI_FLASH_EON is not set
+# CONFIG_SPI_FLASH_GIGADEVICE is not set
+# CONFIG_SPI_FLASH_ISSI is not set
+# CONFIG_SPI_FLASH_MACRONIX is not set
+# CONFIG_SPI_FLASH_SPANSION is not set
+CONFIG_SPI_FLASH_STMICRO=y
+# CONFIG_SPI_FLASH_SST is not set
+# CONFIG_SPI_FLASH_WINBOND is not set
+# CONFIG_SPI_FLASH_XMC is not set
+CONFIG_SPI_FLASH_USE_4K_SECTORS=y
+# CONFIG_SPI_FLASH_DATAFLASH is not set
+# CONFIG_SPL_SPI_FLASH_MTD is not set
+
+#
+# UBI support
+#
+# CONFIG_UBI_SILENCE_MSG is not set
+# CONFIG_MTD_UBI is not set
+# CONFIG_BITBANGMII is not set
+# CONFIG_MV88E6352_SWITCH is not set
+CONFIG_PHYLIB=y
+# CONFIG_PHY_ADDR_ENABLE is not set
+# CONFIG_B53_SWITCH is not set
+# CONFIG_MV88E61XX_SWITCH is not set
+# CONFIG_PHYLIB_10G is not set
+# CONFIG_PHY_AQUANTIA is not set
+# CONFIG_PHY_ATHEROS is not set
+# CONFIG_PHY_BROADCOM is not set
+# CONFIG_PHY_CORTINA is not set
+# CONFIG_PHY_DAVICOM is not set
+# CONFIG_PHY_ET1011C is not set
+# CONFIG_PHY_LXT is not set
+# CONFIG_PHY_MARVELL is not set
+# CONFIG_PHY_MESON_GXL is not set
+CONFIG_PHY_MICREL=y
+CONFIG_PHY_MICREL_KSZ90X1=y
+# CONFIG_PHY_MICREL_KSZ8XXX is not set
+# CONFIG_PHY_MSCC is not set
+# CONFIG_PHY_NATSEMI is not set
+# CONFIG_PHY_REALTEK is not set
+# CONFIG_PHY_SMSC is not set
+# CONFIG_PHY_TERANETICS is not set
+# CONFIG_PHY_TI is not set
+# CONFIG_PHY_VITESSE is not set
+# CONFIG_PHY_XILINX is not set
+# CONFIG_PHY_XILINX_GMII2RGMII is not set
+# CONFIG_PHY_FIXED is not set
+# CONFIG_PHY_NCSI is not set
+# CONFIG_FSL_PFE is not set
+CONFIG_DM_ETH=y
+# CONFIG_DM_MDIO is not set
+# CONFIG_DM_ETH_PHY is not set
+CONFIG_NETDEVICES=y
+CONFIG_PHY_GIGE=y
+# CONFIG_ALTERA_TSE is not set
+# CONFIG_BCM_SF2_ETH is not set
+# CONFIG_BCMGENET is not set
+CONFIG_DWC_ETH_QOS=y
+# CONFIG_E1000 is not set
+# CONFIG_ETH_DESIGNWARE is not set
+# CONFIG_ETHOC is not set
+# CONFIG_FEC_MXC_SHARE_MDIO is not set
+CONFIG_FEC_MXC=y
+# CONFIG_FMAN_ENET is not set
+# CONFIG_FTMAC100 is not set
+# CONFIG_FTGMAC100 is not set
+# CONFIG_MCFFEC is not set
+# CONFIG_FSLDMAFEC is not set
+# CONFIG_MACB is not set
+# CONFIG_RGMII is not set
+CONFIG_MII=y
+# CONFIG_RTL8139 is not set
+# CONFIG_RTL8169 is not set
+# CONFIG_SMC911X is not set
+# CONFIG_SUN7I_GMAC is not set
+# CONFIG_SUN4I_EMAC is not set
+# CONFIG_SUN8I_EMAC is not set
+# CONFIG_SH_ETHER is not set
+# CONFIG_DRIVER_TI_CPSW is not set
+# CONFIG_DRIVER_TI_EMAC is not set
+# CONFIG_DRIVER_TI_KEYSTONE_NET is not set
+# CONFIG_SYS_DPAA_QBMAN is not set
+# CONFIG_TSEC_ENET is not set
+# CONFIG_MEDIATEK_ETH is not set
+# CONFIG_HIGMACV300_ETH is not set
+# CONFIG_PCI is not set
+
+#
+# PCI Endpoint
+#
+# CONFIG_PCI_ENDPOINT is not set
+# CONFIG_X86_PCH7 is not set
+# CONFIG_X86_PCH9 is not set
+
+#
+# PHY Subsystem
+#
+# CONFIG_PHY is not set
+# CONFIG_SPL_PHY is not set
+# CONFIG_MVEBU_COMPHY_SUPPORT is not set
+
+#
+# Pin controllers
+#
+CONFIG_PINCTRL=y
+CONFIG_PINCTRL_FULL=y
+CONFIG_PINCTRL_GENERIC=y
+CONFIG_PINMUX=y
+# CONFIG_PINCONF is not set
+CONFIG_PINCONF_RECURSIVE=y
+# CONFIG_PINCTRL_AT91 is not set
+# CONFIG_PINCTRL_AT91PIO4 is not set
+# CONFIG_PINCTRL_INTEL is not set
+# CONFIG_PINCTRL_ROCKCHIP_RV1108 is not set
+# CONFIG_PINCTRL_SINGLE is not set
+# CONFIG_PINCTRL_STM32 is not set
+# CONFIG_PINCTRL_STMFX is not set
+CONFIG_PINCTRL_IMX=y
+CONFIG_PINCTRL_IMX8M=y
+
+#
+# Power
+#
+# CONFIG_ACPI_PMC is not set
+# CONFIG_SPL_ACPI_PMC is not set
+# CONFIG_TPL_ACPI_PMC is not set
+
+#
+# Power Domain Support
+#
+# CONFIG_POWER_DOMAIN is not set
+# CONFIG_DM_PMIC is not set
+# CONFIG_PMIC_AS3722 is not set
+# CONFIG_POWER_MC34VR500 is not set
+CONFIG_DM_REGULATOR=y
+# CONFIG_SPL_DM_REGULATOR is not set
+# CONFIG_REGULATOR_PWM is not set
+CONFIG_DM_REGULATOR_COMMON=y
+CONFIG_DM_REGULATOR_FIXED=y
+# CONFIG_SPL_DM_REGULATOR_FIXED is not set
+CONFIG_DM_REGULATOR_GPIO=y
+# CONFIG_SPL_DM_REGULATOR_GPIO is not set
+# CONFIG_DM_REGULATOR_PBIAS is not set
+# CONFIG_DM_REGULATOR_TPS62360 is not set
+# CONFIG_POWER_MT6323 is not set
+# CONFIG_DM_PWM is not set
+# CONFIG_PWM_IMX is not set
+# CONFIG_PWM_SANDBOX is not set
+# CONFIG_U_QE is not set
+# CONFIG_RAM is not set
+
+#
+# Remote Processor drivers
+#
+
+#
+# Reset Controller Support
+#
+# CONFIG_DM_RESET is not set
+# CONFIG_DM_RNG is not set
+
+#
+# Real Time Clock
+#
+# CONFIG_DM_RTC is not set
+# CONFIG_RTC_ENABLE_32KHZ_OUTPUT is not set
+# CONFIG_RTC_RX8025 is not set
+# CONFIG_RTC_PL031 is not set
+# CONFIG_RTC_S35392A is not set
+# CONFIG_RTC_MC146818 is not set
+# CONFIG_RTC_M41T62 is not set
+# CONFIG_SCSI is not set
+# CONFIG_DM_SCSI is not set
+
+#
+# Serial drivers
+#
+CONFIG_BAUDRATE=115200
+CONFIG_SPECIFY_CONSOLE_INDEX=y
+CONFIG_CONS_INDEX=1
+# CONFIG_DM_SERIAL is not set
+# CONFIG_ATMEL_USART is not set
+# CONFIG_FSL_LPUART is not set
+# CONFIG_MVEBU_A3700_UART is not set
+# CONFIG_MCFUART is not set
+CONFIG_MXC_UART=y
+# CONFIG_NULLDEV_SERIAL is not set
+# CONFIG_SYS_NS16550 is not set
+# CONFIG_NS16550_DYNAMIC is not set
+# CONFIG_PL010_SERIAL is not set
+# CONFIG_PL011_SERIAL is not set
+# CONFIG_PXA_SERIAL is not set
+# CONFIG_SMEM is not set
+
+#
+# Sound support
+#
+# CONFIG_SOUND is not set
+
+#
+# SOC (System On Chip) specific Drivers
+#
+# CONFIG_SOC_TI is not set
+CONFIG_SPI=y
+CONFIG_DM_SPI=y
+CONFIG_SPI_MEM=y
+# CONFIG_ALTERA_SPI is not set
+# CONFIG_ATCSPI200_SPI is not set
+# CONFIG_ATMEL_SPI is not set
+# CONFIG_BCMSTB_SPI is not set
+# CONFIG_CADENCE_QSPI is not set
+# CONFIG_CF_SPI is not set
+# CONFIG_DESIGNWARE_SPI is not set
+# CONFIG_EXYNOS_SPI is not set
+# CONFIG_FSL_DSPI is not set
+# CONFIG_ICH_SPI is not set
+# CONFIG_MPC8XXX_SPI is not set
+# CONFIG_MTK_SNFI_SPI is not set
+# CONFIG_MVEBU_A3700_SPI is not set
+# CONFIG_NXP_FSPI is not set
+# CONFIG_PL022_SPI is not set
+# CONFIG_ROCKCHIP_SPI is not set
+# CONFIG_SPI_SIFIVE is not set
+# CONFIG_SPI_SUNXI is not set
+# CONFIG_TEGRA114_SPI is not set
+# CONFIG_TEGRA20_SFLASH is not set
+# CONFIG_TEGRA20_SLINK is not set
+# CONFIG_TEGRA210_QSPI is not set
+# CONFIG_TI_QSPI is not set
+# CONFIG_XILINX_SPI is not set
+# CONFIG_SOFT_SPI is not set
+# CONFIG_FSL_ESPI is not set
+CONFIG_FSL_FSPI=y
+# CONFIG_FSL_FSPI_NAND is not set
+# CONFIG_FSL_QSPI is not set
+# CONFIG_SH_QSPI is not set
+# CONFIG_KIRKWOOD_SPI is not set
+# CONFIG_MXC_SPI is not set
+# CONFIG_FSL_LPSPI is not set
+# CONFIG_MXS_SPI is not set
+# CONFIG_OMAP3_SPI is not set
+
+#
+# SPMI support
+#
+# CONFIG_SPMI is not set
+
+#
+# System reset device drivers
+#
+CONFIG_SYSRESET=y
+# CONFIG_SYSRESET_GPIO is not set
+CONFIG_SYSRESET_PSCI=y
+# CONFIG_SYSRESET_SYSCON is not set
+# CONFIG_SYSRESET_WATCHDOG is not set
+# CONFIG_SYSRESET_MPC83XX is not set
+# CONFIG_TEE is not set
+# CONFIG_OPTEE is not set
+CONFIG_DM_THERMAL=y
+# CONFIG_TI_DRA7_THERMAL is not set
+CONFIG_NXP_TMU=y
+
+#
+# Timer Support
+#
+# CONFIG_TIMER is not set
+
+#
+# TPM support
+#
+CONFIG_USB=y
+CONFIG_DM_USB=y
+# CONFIG_DM_USB_GADGET is not set
+
+#
+# USB Host Controller Drivers
+#
+CONFIG_USB_HOST=y
+CONFIG_USB_XHCI_HCD=y
+CONFIG_USB_XHCI_DWC3=y
+# CONFIG_USB_XHCI_DWC3_OF_SIMPLE is not set
+# CONFIG_USB_XHCI_PCI is not set
+# CONFIG_USB_XHCI_FSL is not set
+CONFIG_USB_XHCI_IMX8M=y
+# CONFIG_USB_EHCI_HCD is not set
+# CONFIG_USB_OHCI_HCD is not set
+# CONFIG_USB_OHCI_PCI is not set
+# CONFIG_USB_UHCI_HCD is not set
+# CONFIG_USB_DWC2 is not set
+# CONFIG_USB_R8A66597_HCD is not set
+CONFIG_USB_DWC3=y
+CONFIG_USB_DWC3_GADGET=y
+
+#
+# Platform Glue Driver Support
+#
+# CONFIG_USB_DWC3_OMAP is not set
+
+#
+# PHY Subsystem
+#
+# CONFIG_USB_DWC3_PHY_OMAP is not set
+# CONFIG_USB_DWC3_PHY_SAMSUNG is not set
+# CONFIG_USB_CDNS3 is not set
+
+#
+# Legacy MUSB Support
+#
+# CONFIG_USB_MUSB_HCD is not set
+# CONFIG_USB_MUSB_UDC is not set
+
+#
+# MUSB Controller Driver
+#
+# CONFIG_USB_MUSB_HOST is not set
+# CONFIG_USB_MUSB_GADGET is not set
+# CONFIG_USB_MUSB_DA8XX is not set
+# CONFIG_USB_MUSB_TI is not set
+# CONFIG_USB_MUSB_AM35X is not set
+# CONFIG_USB_MUSB_DSPS is not set
+# CONFIG_USB_MUSB_PIO_ONLY is not set
+
+#
+# USB Phy
+#
+# CONFIG_TWL4030_USB is not set
+# CONFIG_OMAP_USB_PHY is not set
+# CONFIG_ROCKCHIP_USB2_PHY is not set
+
+#
+# ULPI drivers
+#
+
+#
+# USB peripherals
+#
+# CONFIG_USB_STORAGE is not set
+# CONFIG_USB_KEYBOARD is not set
+CONFIG_USB_GADGET=y
+CONFIG_USB_GADGET_MANUFACTURER="FSL"
+CONFIG_USB_GADGET_VENDOR_NUM=0x0525
+CONFIG_USB_GADGET_PRODUCT_NUM=0xa4a5
+# CONFIG_USB_GADGET_ATMEL_USBA is not set
+# CONFIG_USB_GADGET_BCM_UDC_OTG_PHY is not set
+# CONFIG_USB_GADGET_DWC2_OTG is not set
+# CONFIG_CI_UDC is not set
+CONFIG_USB_GADGET_VBUS_DRAW=2
+CONFIG_SDP_LOADADDR=0
+CONFIG_USB_GADGET_DUALSPEED=y
+CONFIG_USB_GADGET_DOWNLOAD=y
+# CONFIG_USB_FUNCTION_MASS_STORAGE is not set
+# CONFIG_USB_FUNCTION_ROCKUSB is not set
+# CONFIG_USB_FUNCTION_SDP is not set
+# CONFIG_USB_FUNCTION_THOR is not set
+# CONFIG_USB_ETHER is not set
+# CONFIG_USB_HOST_ETHER is not set
+
+#
+# UFS Host Controller Support
+#
+# CONFIG_TI_J721E_UFS is not set
+
+#
+# Graphics support
+#
+CONFIG_DM_VIDEO=y
+# CONFIG_BACKLIGHT_GPIO is not set
+CONFIG_VIDEO_BPP8=y
+CONFIG_VIDEO_BPP16=y
+CONFIG_VIDEO_BPP32=y
+CONFIG_VIDEO_ANSI=y
+CONFIG_VIDEO_MIPI_DSI=y
+CONFIG_CONSOLE_NORMAL=y
+# CONFIG_CONSOLE_ROTATION is not set
+# CONFIG_CONSOLE_TRUETYPE is not set
+CONFIG_SYS_WHITE_ON_BLACK=y
+# CONFIG_NO_FB_CLEAR is not set
+
+#
+# TrueType Fonts
+#
+# CONFIG_VIDCONSOLE_AS_LCD is not set
+# CONFIG_VIDEO_VESA is not set
+# CONFIG_VIDEO_LCD_ANX9804 is not set
+# CONFIG_VIDEO_LCD_ORISETECH_OTM8009A is not set
+# CONFIG_VIDEO_LCD_RAYDIUM_RM68200 is not set
+CONFIG_VIDEO_LCD_RAYDIUM_RM67191=y
+# CONFIG_VIDEO_LCD_SSD2828 is not set
+# CONFIG_VIDEO_MESON is not set
+# CONFIG_VIDEO_MVEBU is not set
+# CONFIG_I2C_EDID is not set
+# CONFIG_DISPLAY is not set
+# CONFIG_ATMEL_HLCD is not set
+# CONFIG_VIDEO_FSL_DCU_FB is not set
+# CONFIG_VIDEO_ROCKCHIP is not set
+# CONFIG_VIDEO_ARM_MALIDP is not set
+# CONFIG_VIDEO_STM32 is not set
+# CONFIG_VIDEO_TEGRA20 is not set
+# CONFIG_VIDEO_TEGRA124 is not set
+CONFIG_VIDEO_BRIDGE=y
+# CONFIG_VIDEO_BRIDGE_PARADE_PS862X is not set
+# CONFIG_VIDEO_BRIDGE_NXP_PTN3460 is not set
+# CONFIG_VIDEO_BRIDGE_ANALOGIX_ANX6345 is not set
+# CONFIG_VIDEO_IMX8M_DCSS is not set
+# CONFIG_VIDEO_IMX8M_HDMI is not set
+CONFIG_VIDEO_SEC_MIPI_DSI=y
+CONFIG_VIDEO_IMX_SEC_DSI=y
+# CONFIG_VIDEO_IMX_NW_DSI is not set
+CONFIG_VIDEO_IMX_LCDIFV3=y
+CONFIG_CONSOLE_SCROLL_LINES=1
+# CONFIG_LCD is not set
+# CONFIG_VIDEO_SIMPLE is not set
+# CONFIG_VIDEO_DT_SIMPLEFB is not set
+# CONFIG_OSD is not set
+CONFIG_VIDEO_LINK=y
+# CONFIG_VIDEO_IT6263_BRIDGE is not set
+CONFIG_VIDEO_ADV7535=y
+
+#
+# VirtIO Drivers
+#
+# CONFIG_VIRTIO_MMIO is not set
+
+#
+# 1-Wire support
+#
+# CONFIG_W1 is not set
+
+#
+# 1-wire EEPROM support
+#
+# CONFIG_W1_EEPROM is not set
+
+#
+# Watchdog Timer Support
+#
+# CONFIG_WATCHDOG is not set
+CONFIG_WATCHDOG_TIMEOUT_MSECS=60000
+# CONFIG_WATCHDOG_RESET_DISABLE is not set
+# CONFIG_IMX_WATCHDOG is not set
+# CONFIG_ULP_WATCHDOG is not set
+# CONFIG_DESIGNWARE_WATCHDOG is not set
+# CONFIG_WDT is not set
+# CONFIG_PHYS_TO_BUS is not set
+
+#
+# File systems
+#
+# CONFIG_FS_BTRFS is not set
+# CONFIG_FS_CBFS is not set
+# CONFIG_SPL_FS_CBFS is not set
+CONFIG_FS_EXT4=y
+CONFIG_EXT4_WRITE=y
+CONFIG_FS_FAT=y
+CONFIG_FAT_WRITE=y
+CONFIG_FS_FAT_MAX_CLUSTSIZE=65536
+# CONFIG_FS_JFFS2 is not set
+# CONFIG_UBIFS_SILENCE_MSG is not set
+# CONFIG_FS_CRAMFS is not set
+# CONFIG_YAFFS2 is not set
+
+#
+# Library routines
+#
+# CONFIG_BCH is not set
+# CONFIG_CC_OPTIMIZE_LIBS_FOR_SPEED is not set
+# CONFIG_DYNAMIC_CRC_TABLE is not set
+CONFIG_LIB_UUID=y
+CONFIG_PRINTF=y
+CONFIG_SPL_PRINTF=y
+CONFIG_SPRINTF=y
+CONFIG_SPL_SPRINTF=y
+CONFIG_STRTO=y
+CONFIG_SPL_STRTO=y
+CONFIG_IMAGE_SPARSE=y
+CONFIG_IMAGE_SPARSE_FILLBUF_SIZE=0x80000
+CONFIG_SYS_HZ=1000
+CONFIG_SPL_USE_TINY_PRINTF=y
+# CONFIG_PANIC_HANG is not set
+CONFIG_REGEX=y
+CONFIG_LIB_RAND=y
+# CONFIG_LIB_HW_RAND is not set
+# CONFIG_SPL_TINY_MEMSET is not set
+# CONFIG_TPL_TINY_MEMSET is not set
+# CONFIG_BITREVERSE is not set
+# CONFIG_TRACE is not set
+# CONFIG_CMD_DHRYSTONE is not set
+
+#
+# Security support
+#
+# CONFIG_AES is not set
+# CONFIG_RSA is not set
+# CONFIG_ASYMMETRIC_KEY_TYPE is not set
+# CONFIG_TPM is not set
+
+#
+# Android Verified Boot
+#
+# CONFIG_LIBAVB is not set
+# CONFIG_AVB_SUPPORT is not set
+# CONFIG_AVB_WARNING_LOGO is not set
+CONFIG_AVB_WARNING_TIME_LAST=0x3
+# CONFIG_BOOTLOADER_MENU is not set
+# CONFIG_APPEND_BOOTARGS is not set
+# CONFIG_DUAL_BOOTLOADER is not set
+# CONFIG_AT_AUTHENTICATE_UNLOCK is not set
+# CONFIG_SECURE_UNLOCK is not set
+# CONFIG_ANDROID_DYNAMIC_PARTITION is not set
+# CONFIG_VIRTUAL_AB_SUPPORT is not set
+
+#
+# Hashing Support
+#
+CONFIG_SHA1=y
+CONFIG_SHA256=y
+# CONFIG_SHA_HW_ACCEL is not set
+CONFIG_MD5=y
+
+#
+# Compression Support
+#
+# CONFIG_LZ4 is not set
+# CONFIG_LZMA is not set
+CONFIG_LZO=y
+CONFIG_GZIP=y
+CONFIG_ZLIB=y
+# CONFIG_ZSTD is not set
+# CONFIG_SPL_LZ4 is not set
+# CONFIG_SPL_LZO is not set
+# CONFIG_SPL_GZIP is not set
+# CONFIG_SPL_ZSTD is not set
+# CONFIG_ERRNO_STR is not set
+# CONFIG_HEXDUMP is not set
+CONFIG_OF_LIBFDT=y
+CONFIG_OF_LIBFDT_ASSUME_MASK=0
+CONFIG_OF_LIBFDT_OVERLAY=y
+CONFIG_SPL_OF_LIBFDT=y
+CONFIG_SPL_OF_LIBFDT_ASSUME_MASK=0xff
+# CONFIG_TPL_OF_LIBFDT is not set
+CONFIG_TPL_OF_LIBFDT_ASSUME_MASK=0xff
+
+#
+# System tables
+#
+CONFIG_GENERATE_SMBIOS_TABLE=y
+CONFIG_SMBIOS_MANUFACTURER="freescale"
+CONFIG_EFI_LOADER=y
+CONFIG_EFI_DEVICE_PATH_TO_TEXT=y
+CONFIG_EFI_LOADER_HII=y
+CONFIG_EFI_UNICODE_COLLATION_PROTOCOL2=y
+CONFIG_EFI_UNICODE_CAPITALIZATION=y
+# CONFIG_EFI_UNICODE_COLLATION_PROTOCOL is not set
+# CONFIG_EFI_LOADER_BOUNCE_BUFFER is not set
+CONFIG_EFI_PLATFORM_LANG_CODES="en-US"
+CONFIG_EFI_HAVE_RUNTIME_RESET=y
+# CONFIG_EFI_LOAD_FILE2_INITRD is not set
+# CONFIG_TEST_FDTDEC is not set
+# CONFIG_UNIT_TEST is not set
diff --git a/drivers/net/dwc_eth_qos.c b/drivers/net/dwc_eth_qos.c
index d8c21be5..b9f9b042 100644
--- a/drivers/net/dwc_eth_qos.c
+++ b/drivers/net/dwc_eth_qos.c
@@ -2037,6 +2037,23 @@ static int eqos_remove_resources_imx(struct udevice *dev)
 	return 0;
 }
 
+static int phy_ksz9131_led_errata_at_eqos_probe(struct udevice *dev, struct mii_dev *mii)
+{
+	u16 tmp;
+	int addr = -1;
+#ifdef CONFIG_DM_ETH_PHY
+	addr = eth_phy_get_addr(dev);
+#endif
+#ifdef DWC_NET_PHYADDR
+	addr = DWC_NET_PHYADDR;
+#endif
+	tmp = eqos_mdio_read(mii, addr, MDIO_DEVAD_NONE, 0x1e);
+	tmp |= (1 << 9);
+	eqos_mdio_write(mii, addr, MDIO_DEVAD_NONE, 0x1e, tmp);
+
+	return 0;
+}
+
 static int eqos_probe(struct udevice *dev)
 {
 	struct eqos_priv *eqos = dev_get_priv(dev);
@@ -2095,6 +2112,8 @@ static int eqos_probe(struct udevice *dev)
 	eth_phy_set_mdio_bus(dev, eqos->mii);
 #endif
 
+	phy_ksz9131_led_errata_at_eqos_probe(dev, eqos->mii);
+
 	debug("%s: OK\n", __func__);
 	return 0;
 
diff --git a/drivers/net/fec_mxc.c b/drivers/net/fec_mxc.c
index d00df87a..7f39e582 100644
--- a/drivers/net/fec_mxc.c
+++ b/drivers/net/fec_mxc.c
@@ -636,8 +636,7 @@ static int fec_init(struct eth_device *dev, bd_t *bd)
 	if (fec->xcv_type != SEVENWIRE)
 		miiphy_restart_aneg(dev);
 #endif
-	fec_open(dev);
-	return 0;
+	return fec_open(dev);
 }
 
 /**
diff --git a/drivers/net/phy/micrel_ksz90x1.c b/drivers/net/phy/micrel_ksz90x1.c
index 0105fc5a..39822ab8 100644
--- a/drivers/net/phy/micrel_ksz90x1.c
+++ b/drivers/net/phy/micrel_ksz90x1.c
@@ -14,6 +14,8 @@
 #include <errno.h>
 #include <micrel.h>
 #include <phy.h>
+#include <console.h>
+#include <stdio.h>
 
 /*
  * KSZ9021 - KSZ9031 common
@@ -341,6 +343,9 @@ static int ksz9031_phy_extwrite(struct phy_device *phydev, int addr,
 					  MII_KSZ9031_MOD_DATA_POST_INC_RW, val);
 }
 
+#define KSZ9131_RX_DLL_CTRL     0x4c
+#define KSZ9131_TX_DLL_CTRL     0x4d
+#define KSZ9131_DLL_CTRL_BYPASS BIT(12)
 static int ksz9031_config(struct phy_device *phydev)
 {
 	int ret;
@@ -393,9 +398,101 @@ static struct phy_driver ksz9031_driver = {
 	.readext = &ksz9031_phy_extread,
 };
 
+/* Silicon Errata DS80000693B
+ *
+ * When LEDs are configured in Individual Mode, LED1 is ON in a no-link
+ * condition. Workaround is to set register 0x1e, bit 9, this way LED1 behaves
+ * according to the datasheet (off if there is no link).
+ */
+static int ksz9131_led_errata(struct phy_device *phydev)
+{
+        u16 tmp;
+
+	tmp= ksz9031_phy_extended_read(phydev, 2, 0, MII_KSZ9031_MOD_DATA_NO_POST_INC);
+	if (tmp & BIT(4)) {
+                tmp = phy_read(phydev, MDIO_DEVAD_NONE, 0x1e);
+                tmp |= (1 << 9);
+                phy_write(phydev, MDIO_DEVAD_NONE, 0x1e, tmp);
+	}
+
+	return 0;
+}
+
+/*
+ * KSZ9131
+ */
+static int ksz9131_config(struct phy_device *phydev)
+{
+	int ret;
+	u16 tmp;
+
+	/*added for rxc-dll-2ns and txc-dll-2ns*/
+        tmp = ksz9031_phy_extended_read(phydev, 3, KSZ9131_RX_DLL_CTRL,0x4000);
+        //printf("tmp_rx = %x\n",tmp);
+        tmp &= ~KSZ9131_DLL_CTRL_BYPASS;
+        ret = ksz9031_phy_extended_write(phydev, 2, KSZ9131_RX_DLL_CTRL,0x4000, tmp);
+        if (ret < 0)
+                return ret;
+
+        tmp = ksz9031_phy_extended_read(phydev, 3, KSZ9131_TX_DLL_CTRL,0x4000);
+        //printf("tmp_tx = %x\n",tmp);
+        tmp &= ~KSZ9131_DLL_CTRL_BYPASS;
+        ret = ksz9031_phy_extended_write(phydev, 2, KSZ9131_TX_DLL_CTRL,0x4000, tmp);
+        if (ret < 0)
+                return ret;
+        //printf("rxc and txc dll config end!!!!!! %x\n",tmp);
+
+	ret = ksz9031_of_config(phydev);
+	if (ret)
+		return ret;
+
+	/* add an option to disable the gigabit feature of this PHY */
+	if (env_get("disable_giga")) {
+		unsigned features;
+		unsigned bmcr;
+
+		/* disable speed 1000 in features supported by the PHY */
+		features = phydev->drv->features;
+		features &= ~(SUPPORTED_1000baseT_Half |
+				SUPPORTED_1000baseT_Full);
+		phydev->advertising = phydev->supported = features;
+
+		/* disable speed 1000 in Basic Control Register */
+		bmcr = phy_read(phydev, MDIO_DEVAD_NONE, MII_BMCR);
+		bmcr &= ~(1 << 6);
+		phy_write(phydev, MDIO_DEVAD_NONE, MII_BMCR, bmcr);
+
+		/* disable speed 1000 in 1000Base-T Control Register */
+		phy_write(phydev, MDIO_DEVAD_NONE, MII_CTRL1000, 0);
+
+		/* start autoneg */
+		genphy_config_aneg(phydev);
+		genphy_restart_aneg(phydev);
+
+		return 0;
+	}
+
+	ksz9131_led_errata(phydev);
+
+	return genphy_config(phydev);
+}
+
+static struct phy_driver ksz9131_driver = {
+        .name = "Micrel ksz9131",
+        .uid = 0x221640,
+        .mask = 0xfffff0,
+        .features = PHY_GBIT_FEATURES,
+        .config   = &ksz9131_config,
+        .startup  = &ksz90xx_startup,
+        .shutdown = &genphy_shutdown,
+        .writeext = &ksz9031_phy_extwrite,
+        .readext = &ksz9031_phy_extread,
+};
+
 int phy_micrel_ksz90x1_init(void)
 {
 	phy_register(&ksz9021_driver);
 	phy_register(&ksz9031_driver);
+	phy_register(&ksz9131_driver);
 	return 0;
 }
diff --git a/drivers/usb/host/xhci-imx8m.c b/drivers/usb/host/xhci-imx8m.c
index c9c0c1b2..1c4019ca 100644
--- a/drivers/usb/host/xhci-imx8m.c
+++ b/drivers/usb/host/xhci-imx8m.c
@@ -16,6 +16,7 @@
 #include <asm/arch/sys_proto.h>
 #include <dm.h>
 #include <usb/xhci.h>
+#include <power/regulator.h>
 
 /* Declare global data pointer */
 DECLARE_GLOBAL_DATA_PTR;
@@ -45,6 +46,7 @@ struct imx8m_xhci {
 	struct xhci_hccr *hcd;
 	struct dwc3 *dwc3_reg;
 	struct imx8m_usbmix *usbmix_reg;
+	struct udevice *vbus_supply;
 };
 
 struct imx8m_usbctrl_data {
@@ -150,6 +152,16 @@ static int xhci_imx8m_probe(struct udevice *dev)
 	ctx->usbmix_reg = (struct imx8m_usbmix *)((char *)(ctx->hcd) +
 							USBMIX_PHY_OFFSET);
 
+	ctx->vbus_supply = NULL;
+        ret = device_get_supply_regulator(dev, "vbus-supply", &ctx->vbus_supply);
+	if ((!ret) && ctx->vbus_supply) {
+		ret = regulator_set_enable(ctx->vbus_supply, false);
+		ret = regulator_set_enable(ctx->vbus_supply, true);
+		if (ret) {
+			puts("XHCI: failed to re-enable vbus-supply\n");
+		}
+	}
+
 	ret = board_usb_init(ctr_data[dev->seq].usb_id, USB_INIT_HOST);
 	if (ret != 0) {
 		imx8m_usb_power(ctr_data[dev->seq].usb_id, false);
diff --git a/include/configs/imx8mp_evk.h b/include/configs/imx8mp_evk.h
old mode 100644
new mode 100755
index a89d1611..f88f7cc5
--- a/include/configs/imx8mp_evk.h
+++ b/include/configs/imx8mp_evk.h
@@ -46,18 +46,24 @@
 /* ENET Config */
 /* ENET1 */
 #if defined(CONFIG_CMD_NET)
-#define CONFIG_ETHPRIME                 "eth1" /* Set eqos to primary since we use its MDIO */
+#if 1
+/* ethernet will try eth1 and eth0 sequentially */
+#define CONFIG_ETHPRIME                 "eth1"
+#else
+/* ethernet will try eth0 and eth1 sequentially */
+#define CONFIG_ETHPRIME                 "eth0"
+#endif
 
 #define CONFIG_FEC_XCV_TYPE             RGMII
-#define CONFIG_FEC_MXC_PHYADDR          1
+#define CONFIG_FEC_MXC_PHYADDR          7
 #define FEC_QUIRK_ENET_MAC
 
-#define DWC_NET_PHYADDR			1
+#define DWC_NET_PHYADDR			3
 #ifdef CONFIG_DWC_ETH_QOS
 #define CONFIG_SYS_NONCACHED_MEMORY     (1 * SZ_1M)     /* 1M */
 #endif
 
-#define PHY_ANEG_TIMEOUT 20000
+#define PHY_ANEG_TIMEOUT 8000 /* Shorten switching between 2 ethernet controllers if PHY ANEG fail */
 
 #endif
 
@@ -77,96 +83,116 @@
 	"emmc_dev=2\0"\
 	"sd_dev=1\0" \
 
-
-#ifdef CONFIG_NAND_BOOT
-#define MFG_NAND_PARTITION "mtdparts=gpmi-nand:64m(nandboot),16m(nandfit),32m(nandkernel),16m(nanddtb),8m(nandtee),-(nandrootfs)"
-#endif
-
 /* Initial environment variables */
-#if defined(CONFIG_NAND_BOOT)
-#define CONFIG_EXTRA_ENV_SETTINGS \
-	CONFIG_MFG_ENV_SETTINGS \
-	"splashimage=0x50000000\0" \
-	"fdt_addr=0x43000000\0"			\
-	"fdt_high=0xffffffffffffffff\0" \
-	"mtdparts=" MFG_NAND_PARTITION "\0" \
-	"console=ttymxc1,115200 earlycon=ec_imx6q,0x30890000,115200\0" \
-	"bootargs=console=ttymxc1,115200 earlycon=ec_imx6q,0x30890000,115200 ubi.mtd=nandrootfs "  \
-		"root=ubi0:nandrootfs rootfstype=ubifs "		     \
-		MFG_NAND_PARTITION \
-		"\0" \
-	"bootcmd=nand read ${loadaddr} 0x5000000 0x2000000;"\
-		"nand read ${fdt_addr} 0x7000000 0x100000;"\
-		"booti ${loadaddr} - ${fdt_addr}"
+#define CONFIG_BALENAOS_SETTINGS               \
+"balena_extra_env_file=extra_uEnv.txt\0" \
+"balena_import_extra_env_file=echo Import ${balena_extra_env_file} in environment;env import -t ${resin_kernel_load_addr} ${filesize}\0" \
+"balena_import_scan_dev_extra_env_file=if fatload ${resin_scan_dev_type} ${resin_scan_dev_index}:${resin_boot_part} ${resin_kernel_load_addr} ${balena_extra_env_file}; then run balena_import_extra_env_file; echo Imported ${balena_extra_env_file} from scanned device ${resin_scan_dev_type}:${resin_scan_dev_index} in environment;else echo File ${balena_extra_env_file} not found on scanned device ${resin_scan_dev_type}:${resin_scan_dev_index}; fi; \0" \
+"balena_load_extra_env_file=echo Loading ${balena_extra_env_file} from ${resin_dev_type} device ${resin_dev_index} partition ${resin_boot_part};fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${resin_kernel_load_addr} ${balena_extra_env_file};\0" \
+"baudrate=115200\0" \
+\
+"boot_fit=no\0" \
+"bootdelay=1\0" \
+"bootdir=/boot\0" \
+"bootscript=echo Running bootscript from mmc ...; source\0" \
+"bsp_bootcmd=echo Running BSP bootcmd ...; setenv resin_kernel_load_addr ${loadaddr}; run resin_set_kernel_root; run set_os_cmdline; setenv mmcdev ${resin_dev_index}; setenv mmcpart ${resin_root_part}; run ramsize_check; mmc dev ${mmcdev}; if mmc rescan; then if test ${use_m7} = yes && run loadm7bin; then run runm7bin; fi; if run loadbootscript; then run bootscript; else if run loadimage; then run mmcboot; else run netboot; fi; fi; fi;\0" \
+"bsp_script=boot.scr\0" \
+"console=ttymxc1,115200\0" \
+\
+"ethact=ethernet@30bf0000\0" \
+"ethaddr=00:04:9f:07:2c:c1\0" \
+"ethprime=eth0\0" \
+\
+"fdt_addr=0x45000000\0" \
+"fdt_addr_r=0x45000000\0" \
+"fdt_file=imx8mp-eg5120.dtb\0" \
+\
+"image=Image.gz\0" \
+"img_addr=0x48440000\0" \
+"kernel_addr_r=0x40480000\0" \
+"loadaddr=0x40480000\0" \
+"loadbootscript=load mmc ${mmcdev}:${mmcpart} ${loadaddr} ${bootdir}/${bsp_script};\0" \
+"loadfdt=echo fdt_file=${fdt_file}; load mmc ${mmcdev}:${mmcpart} ${fdt_addr} ${bootdir}/${fdt_file}\0" \
+"loadimage=load mmc ${mmcdev}:${mmcpart} ${img_addr} ${bootdir}/${image};unzip ${img_addr} ${loadaddr}\0" \
+"loadm7bin=load mmc ${mmcdev}:${mmcpart} ${loadaddr} ${bootdir}/${m7_bin} && cp.b ${loadaddr} ${m7_addr} ${filesize}; echo Init rsc_table region memory; mw.b 400ff000 0 10\0" \
+"m7_addr=0x7e0000\0" \
+"m7_bin=hello_world.bin\0" \
+"mmcargs=setenv bootargs console=${console} ${resin_kernel_root} ${os_cmdline} rootwait rw ${cma_size} cma_name=linux,cma\0" \
+"mmcblk=2\0" \
+"mmcboot=echo Booting from mmc ...; run mmcargs; run optargs; if test ${boot_fit} = yes || test ${boot_fit} = try; then bootm ${loadaddr}; else if run loadfdt; then booti ${loadaddr} - ${fdt_addr_r}; else echo WARN: Cannot load the DT; fi; fi;\0" \
+"mmcdev=2\0" \
+"mmcpart=1\0" \
+\
+"netargs=setenv bootargs console=${console} root=/dev/nfs ${cma_size} cma_name=linux,cma ip=dhcp nfsroot=${serverip}:${nfsroot},v3,tcp\0" \
+"netboot=echo Booting from net ...; run netargs;  run optargs;  if test ${ip_dyn} = yes; then setenv get_cmd dhcp; else setenv get_cmd tftp; fi; ${get_cmd} ${img_addr} ${image}; unzip ${img_addr} ${loadaddr}; if test ${boot_fit} = yes || test ${boot_fit} = try; then bootm ${loadaddr}; else echo fdt_file=${fdt_file}; if ${get_cmd} ${fdt_addr} ${fdt_file}; then booti ${loadaddr} - ${fdt_addr_r}; else echo WARN: Cannot load the DT; fi; fi;\0" \
+"optargs=setenv bootargs ${bootargs} ${kernelargs};\0" \
+"os_bc_file=bootcount.env\0" \
+"os_bc_inced=0\0" \
+"os_bc_lim=3\0" \
+"os_bc_skip=0\0" \
+"os_bc_wr_sz=0xd\0" \
+"os_import_bootcount_file=echo Import ${os_bc_file} in environment;env import -t ${resin_kernel_load_addr} ${filesize}\0" \
+"os_inc_bc_save=if test ${os_bc_skip} = 0 && test ${os_bc_inced} = 0 && test ${upgrade_available} = 1; then setexpr bootcount ${bootcount} + 1;env set os_bc_inced 1;echo bootcount=${bootcount} now;env export -t ${resin_kernel_load_addr} bootcount;if fatwrite ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${resin_kernel_load_addr} ${os_bc_file} ${os_bc_wr_sz}; then; else; echo FATWRITE FAILED ; fi;echo bootcount=${bootcount} written to ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${os_bc_file};fi;\0" \
+"os_load_bootcount_file=echo Loading ${os_bc_file} from ${resin_dev_type} device ${resin_dev_index} partition ${resin_boot_part};fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${resin_kernel_load_addr} ${os_bc_file};\0" \
+"ramsize_check=if test $sdram_size -le 512; then setenv cma_size cma=320M; else if test $sdram_size -le 1024; then setenv cma_size cma=576M; else setenv cma_size cma=960M; fi; fi;\0" \
+"resin_boot_part=1\0" \
+"resin_check_altroot=setexpr resin_roota ${resin_boot_part} + 1; setexpr resin_rootb ${resin_boot_part} + 2; run os_inc_bc_save;if test -n ${os_bc_lim}; then if test ${bootcount} -gt ${os_bc_lim}; then echo WARNING! BOOTLIMIT EXCEEDED. SWITCHING TO PREVIOUS ROOT;echo WARNING! was: resin_root_part=${resin_root_part};if test ${resin_root_part} = ${resin_roota}; then env set resin_root_part ${resin_rootb}; else; env set resin_root_part ${resin_roota}; fi;echo WARNING! now: resin_root_part=${resin_root_part};fi;fi;\0" \
+"resin_env_file=resinOS_uEnv.txt\0" \
+"resin_find_root_part_uuid=fsuuid ${resin_dev_type} ${resin_dev_index}:${resin_root_part} resin_root_part_uuid\0" \
+"resin_flasher_detect=if test \"${resin_scan_dev_type}\" = usb ; then usb start ; fi; fatload ${resin_scan_dev_type} ${resin_scan_dev_index}:${resin_boot_part} ${resin_kernel_load_addr} ${resin_flasher_flag_file};\0" \
+"resin_flasher_flag_file=balena-image-flasher\0" \
+"resin_flasher_skip=0\0" \
+"resin_image_detect=if test \"${resin_scan_dev_type}\" = usb ; then usb start ; fi; fatload ${resin_scan_dev_type} ${resin_scan_dev_index}:${resin_boot_part} ${resin_kernel_load_addr} ${resin_image_flag_file};\0" \
+"resin_image_flag_file=balena-image\0" \
+"resin_import_env_file=echo Import ${resin_env_file} in environment;env import -t ${resin_kernel_load_addr} ${filesize}\0" \
+"resin_inject_env_file=if run resin_load_env_file; then run resin_import_env_file;fi;if run balena_load_extra_env_file; then run balena_import_extra_env_file;fi;if run os_load_bootcount_file; then run os_import_bootcount_file;else; echo No bootcount.env file. Setting bootcount=0 in environment;env set bootcount 0;fi;\0" \
+"resin_load_env_file=echo Loading ${resin_env_file} from ${resin_dev_type} device ${resin_dev_index} partition ${resin_boot_part};fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${resin_kernel_load_addr} ${resin_env_file};\0" \
+"resin_root_part=2\0" \
+"resin_scan_devs=echo Scanning ${resin_uboot_device_types} devices ${resin_uboot_devices}; for resin_scan_dev_type in ${resin_uboot_device_types}; do for resin_scan_dev_index in ${resin_uboot_devices}; do run balena_import_scan_dev_extra_env_file; if test ${resin_flasher_skip} = 0 && run resin_flasher_detect; then setenv resin_flasher_dev_index ${resin_scan_dev_index}; setenv resin_dev_type ${resin_scan_dev_type}; exit; else; if test -n \"${resin_image_dev_index}\"; then ;else if run resin_image_detect; then setenv resin_image_dev_index ${resin_scan_dev_index}; setenv resin_dev_type ${resin_scan_dev_type}; fi; fi; fi; done;done;\0" \
+"resin_set_dev_index=run resin_scan_devs; if test -n ${resin_flasher_dev_index}; then echo Found resin flasher on ${resin_dev_type} ${resin_flasher_dev_index}; setenv bootparam_flasher flasher; setenv resin_dev_index ${resin_flasher_dev_index}; else; if test -n \"${resin_image_dev_index}\"; then echo Found resin image on ${resin_dev_type} ${resin_image_dev_index}; setenv resin_dev_index ${resin_image_dev_index}; else; echo ERROR: Could not find a resin image of any sort.; fi; fi;\0" \
+"resin_set_kernel_root=run resin_set_dev_index;run resin_inject_env_file;run resin_check_altroot;run resin_find_root_part_uuid;setenv resin_kernel_root root=UUID=${resin_root_part_uuid}\0" \
+"resin_uboot_device_types=mmc\0" \
+"resin_uboot_devices=0 1 2\0" \
+"runm7bin=if test ${m7_addr} = 0x7e0000; then echo Booting M7 from TCM; else echo Booting M7 from DRAM; dcache flush; fi; bootaux ${m7_addr};\0" \
+"sdram_size=2048\0" \
+"serial#=15041000efbfffdc\0" \
+"set_os_cmdline=setenv os_cmdline ${bootparam_flasher} ${extra_os_cmdline};\0" \
+"upgrade_available=0\0" \
+"use_m7=no\0" \
+
+
+#define CONFIG_EXTRA_ENV_SETTINGS               \
+        CONFIG_MFG_ENV_SETTINGS \
+        "ipaddr=192.168.0.1\0" \
+        "serverip=192.168.0.10\0" \
+        "console=ttymxc1,115200\0" \
+        "fdt_addr=0x43000000\0"                 \
+        "fdt_high=0xffffffffffffffff\0"         \
+        "initrd_addr=0x43800000\0"              \
+        "initrd_high=0xffffffffffffffff\0" \
+        "mmcdev="__stringify(CONFIG_SYS_MMC_ENV_DEV)"\0" \
+        "boot_queue=upgrade normal\0" \
+        "upgradedir=eg5120-uuu-udisk-upgrade\0" \
+        "udisk=0\0" \
+        "udiskargs=setenv bootargs console=${console} auto-upgrade=${upgradedir}\0" \
+        "boot_mode_upgrade=run udiskargs && usb reset && fatinfo usb 0 && load usb ${udisk} ${loadaddr} ${upgradedir}/vmlinuz && load usb ${udisk} ${fdt_addr} ${upgradedir}/imx8mp-evk.dtb && load usb ${udisk} 0x43800000 ${upgradedir}/initrd.img && gpio clear 121 && sleep 0.2 && gpio set 121 && booti ${loadaddr} 0x43800000:${filesize} ${fdt_addr}\0" \
+        "boot_mode_normal=run bsp_bootcmd;\0" \
+	CONFIG_BALENAOS_SETTINGS
 
-#else
-#define CONFIG_EXTRA_ENV_SETTINGS		\
-	CONFIG_MFG_ENV_SETTINGS \
-	JAILHOUSE_ENV \
-	"script=boot.scr\0" \
-	"image=Image\0" \
-	"splashimage=0x50000000\0" \
-	"console=ttymxc1,115200\0" \
-	"fdt_addr=0x43000000\0"			\
-	"fdt_high=0xffffffffffffffff\0"		\
-	"boot_fit=no\0" \
-	"fdt_file=" CONFIG_DEFAULT_FDT_FILE "\0" \
-	"initrd_addr=0x43800000\0"		\
-	"initrd_high=0xffffffffffffffff\0" \
-	"mmcdev="__stringify(CONFIG_SYS_MMC_ENV_DEV)"\0" \
-	"mmcpart=" __stringify(CONFIG_SYS_MMC_IMG_LOAD_PART) "\0" \
-	"mmcroot=" CONFIG_MMCROOT " rootwait rw\0" \
-	"mmcautodetect=yes\0" \
-	"mmcargs=setenv bootargs ${jh_clk} console=${console} root=${mmcroot}\0 " \
-	"loadbootscript=fatload mmc ${mmcdev}:${mmcpart} ${loadaddr} ${script};\0" \
-	"bootscript=echo Running bootscript from mmc ...; " \
-		"source\0" \
-	"loadimage=fatload mmc ${mmcdev}:${mmcpart} ${loadaddr} ${image}\0" \
-	"loadfdt=fatload mmc ${mmcdev}:${mmcpart} ${fdt_addr} ${fdt_file}\0" \
-	"mmcboot=echo Booting from mmc ...; " \
-		"run mmcargs; " \
-		"if test ${boot_fit} = yes || test ${boot_fit} = try; then " \
-			"bootm ${loadaddr}; " \
-		"else " \
-			"if run loadfdt; then " \
-				"booti ${loadaddr} - ${fdt_addr}; " \
-			"else " \
-				"echo WARN: Cannot load the DT; " \
-			"fi; " \
-		"fi;\0" \
-	"netargs=setenv bootargs ${jh_clk} console=${console} " \
-		"root=/dev/nfs " \
-		"ip=dhcp nfsroot=${serverip}:${nfsroot},v3,tcp\0" \
-	"netboot=echo Booting from net ...; " \
-		"run netargs;  " \
-		"if test ${ip_dyn} = yes; then " \
-			"setenv get_cmd dhcp; " \
-		"else " \
-			"setenv get_cmd tftp; " \
-		"fi; " \
-		"${get_cmd} ${loadaddr} ${image}; " \
-		"if test ${boot_fit} = yes || test ${boot_fit} = try; then " \
-			"bootm ${loadaddr}; " \
-		"else " \
-			"if ${get_cmd} ${fdt_addr} ${fdt_file}; then " \
-				"booti ${loadaddr} - ${fdt_addr}; " \
-			"else " \
-				"echo WARN: Cannot load the DT; " \
-			"fi; " \
-		"fi;\0"
 
 #define CONFIG_BOOTCOMMAND \
-	   "mmc dev ${mmcdev}; if mmc rescan; then " \
-		   "if run loadbootscript; then " \
-			   "run bootscript; " \
-		   "else " \
-			   "if run loadimage; then " \
-				   "run mmcboot; " \
-			   "else run netboot; " \
-			   "fi; " \
-		   "fi; " \
-	   "fi;"
-#endif
+	"mmc dev ${mmcdev};" \
+	"echo Booting system;" \
+	"if mmc rescan; then " \
+		"for mode in ${boot_queue}; " \
+		"do " \
+			"echo Trying ${mode} boot ...;" \
+			"run boot_mode_${mode};" \
+		"done;" \
+	"fi;" \
+	"echo Booting system failed, reset ....;" \
+	"reset;"
+
 
 /* Link Definitions */
 #define CONFIG_LOADADDR			0x40480000
@@ -186,22 +212,15 @@
 #define CONFIG_ENV_SPI_MODE		CONFIG_SF_DEFAULT_MODE
 #define CONFIG_ENV_SPI_MAX_HZ		CONFIG_SF_DEFAULT_SPEED
 
-#define CONFIG_SYS_MMC_ENV_DEV		1   /* USDHC2 */
-#define CONFIG_MMCROOT			"/dev/mmcblk1p2"  /* USDHC2 */
+#define CONFIG_SYS_MMC_ENV_DEV		2   /* USDHC2 */
+#define CONFIG_MMCROOT			"/dev/mmcblk2p2"  /* USDHC2 */
 
 /* Size of malloc() pool */
 #define CONFIG_SYS_MALLOC_LEN		SZ_32M
 
-/* Totally 6GB DDR */
-#define CONFIG_SYS_SDRAM_BASE		0x40000000
-#define PHYS_SDRAM			0x40000000
-#define PHYS_SDRAM_SIZE			0xC0000000	/* 3 GB */
-#define PHYS_SDRAM_2			0x100000000
-#ifdef CONFIG_TARGET_IMX8MP_DDR4_EVK
-#define PHYS_SDRAM_2_SIZE		0x40000000	/* 1 GB */
-#else
-#define PHYS_SDRAM_2_SIZE		0xC0000000	/* 3 GB */
-#endif
+#define CONFIG_SYS_SDRAM_BASE           0x40000000
+#define PHYS_SDRAM                      0x40000000
+#define PHYS_SDRAM_SIZE                 0x80000000      /* 2 GB */
 
 #define CONFIG_SYS_MEMTEST_START	0x60000000
 #define CONFIG_SYS_MEMTEST_END		(CONFIG_SYS_MEMTEST_START + \
@@ -227,7 +246,7 @@
 #endif
 #define CONFIG_SYS_FSL_ESDHC_ADDR	0
 
-#define CONFIG_SYS_MMC_IMG_LOAD_PART	1
+#define CONFIG_SYS_MMC_IMG_LOAD_PART	4
 
 #ifdef CONFIG_FSL_FSPI
 #define FSL_FSPI_FLASH_SIZE		SZ_32M
diff --git a/scripts/check-config.sh b/scripts/check-config.sh
index 583f7d09..bb56bca2 100755
--- a/scripts/check-config.sh
+++ b/scripts/check-config.sh
@@ -49,15 +49,15 @@ cat `find ${srctree} -name "Kconfig*"` |sed -n \
 	-e 's/^\s*menuconfig \([A-Za-z0-9_]*\).*$/CONFIG_\1/p' \
 	|sort |uniq > ${ok}
 comm -23 ${suspects} ${ok} >${new_adhoc}
-if [ -s ${new_adhoc} ]; then
-	echo >&2 "Error: You must add new CONFIG options using Kconfig"
-	echo >&2 "The following new ad-hoc CONFIG options were detected:"
-	cat >&2 ${new_adhoc}
-	echo >&2
-	echo >&2 "Please add these via Kconfig instead. Find a suitable Kconfig"
-	echo >&2 "file and add a 'config' or 'menuconfig' option."
-	# Don't delete the temporary files in case they are useful
-	exit 1
-else
+#if [ -s ${new_adhoc} ]; then
+#	echo >&2 "Error: You must add new CONFIG options using Kconfig"
+#	echo >&2 "The following new ad-hoc CONFIG options were detected:"
+#	cat >&2 ${new_adhoc}
+#	echo >&2
+#	echo >&2 "Please add these via Kconfig instead. Find a suitable Kconfig"
+#	echo >&2 "file and add a 'config' or 'menuconfig' option."
+#	# Don't delete the temporary files in case they are useful
+#	exit 1
+#else
 	rm ${suspects} ${ok} ${new_adhoc}
-fi
+#fi
-- 
2.30.2

